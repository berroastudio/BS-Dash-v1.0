<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS Dash - Clientes desde Microsoft 365</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ====== ESTILOS UBUNTU GLASS MEJORADOS ====== */
        :root {
            --bg-primary: #2D0922;
            --bg-secondary: #1a0a15;
            --bg-card: rgba(45, 20, 44, 0.75);
            --bg-hover: rgba(85, 40, 80, 0.8);
            --border-light: rgba(255, 255, 255, 0.15);
            --border-hover: rgba(233, 84, 32, 0.6);
            --text-primary: #FFFFFF;
            --text-secondary: #E8E8E8;
            --text-muted: #AAAAAA;
            --accent-orange: #E95420;
            --accent-purple: #77216F;
            --gradient-primary: linear-gradient(135deg, #E95420, #77216F);
            --gradient-card: linear-gradient(135deg, rgba(65, 25, 60, 0.9), rgba(40, 15, 35, 0.9));
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(rgba(38, 1, 83, 0.16), rgba(21, 0, 48, 0.046)), 
                        url('https://plus.unsplash.com/premium_photo-1685793804465-b12bbd8b7281?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=870');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .ubuntu-glass {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: var(--gradient-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .ubuntu-window {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: var(--gradient-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .window-header {
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border-light);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .window-title {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-control {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .window-control.close { background: #FF5F57; }
        .window-control.minimize { background: #FFBD2E; }
        .window-control.maximize { background: #28CA42; }

        .window-control:hover {
            transform: scale(1.1);
        }

        .window-content {
            padding: 25px;
            max-height: 600px;
            overflow-y: auto;
        }

        .ubuntu-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .ubuntu-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(233, 84, 32, 0.2);
        }

        .ubuntu-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .ubuntu-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .ubuntu-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .ubuntu-btn-primary {
            background: var(--gradient-primary);
            border: none;
            color: white;
        }

        .ubuntu-btn-primary:hover {
            background: linear-gradient(135deg, #77216F, #E95420);
            transform: translateY(-2px);
        }

        /* Dock Interno */
        .internal-dock {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(45, 20, 44, 0.5);
            border-radius: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .dock-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            text-align: center;
        }

        .dock-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .dock-item.active {
            background: var(--gradient-primary);
            transform: translateY(-3px);
        }

        .dock-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .dock-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Contenedor de Ventanas */
        .windows-container {
            min-height: 600px;
            position: relative;
        }

        .window {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }

        .window.hidden {
            display: none;
        }

        /* Búsqueda */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 25px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* Estados */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(32, 201, 151, 0.2);
            color: #20C997;
        }

        .status-inactive {
            background: rgba(255, 107, 107, 0.2);
            color: #FF6B6B;
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes windowOpen {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-window-open {
            animation: windowOpen 0.3s ease-out;
        }

        /* Tablas */
        .clientes-table {
            width: 100%;
            border-collapse: collapse;
        }

        .clientes-table th {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid var(--border-light);
        }

        .clientes-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .clientes-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Tarjetas de Clientes */
        .cliente-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .cliente-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        /* Scrollbar personalizado */
        .window-content::-webkit-scrollbar {
            width: 6px;
        }

        .window-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .window-content::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 3px;
        }

        .window-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
        }

        /* Estados Microsoft */
        .microsoft-connected {
            background: rgba(32, 201, 151, 0.1);
            border: 1px solid rgba(32, 201, 151, 0.3);
        }

        .microsoft-disconnected {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="ubuntu-glass mx-4 mt-4 mb-6">
        <div class="flex items-center justify-between p-6">
            <div class="flex items-center gap-4">
                <a href="dashboard.html" class="ubuntu-btn">
                    <i class="bi bi-arrow-left"></i> Volver al Dashboard
                </a>
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-gradient-to-br from-[#E95420] to-[#77216F]">
                        <i class="bi bi-people text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Clientes desde Microsoft 365</h1>
                        <p class="text-sm text-gray-300">Gestiona tus clientes desde los contactos de Microsoft</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Selector de Empresa -->
                <div class="flex items-center gap-2 bg-gray-800 bg-opacity-50 px-3 py-2 rounded-lg border border-gray-700">
                    <label class="text-sm font-medium">Empresa:</label>
                    <select id="empresaSwitcher" class="bg-transparent border-none outline-none text-sm text-white" onchange="cambiarEmpresa()">
                        <option value="1">Berroa Studio S.R.L.</option>
                        <option value="2">Empresa Secundaria</option>
                        <option value="3">Otra Empresa</option>
                    </select>
                </div>

                <span class="text-gray-300" id="userName">Cargando...</span>
                <button onclick="logout()" class="ubuntu-btn bg-red-500 bg-opacity-20 text-red-400 border-red-500 border-opacity-30">
                    <i class="bi bi-box-arrow-right"></i> Salir
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-8">
        <!-- Barra de Búsqueda Global -->
        <div class="search-container">
            <input type="text" id="globalSearch" class="search-input" placeholder="Buscar clientes en Microsoft 365..." onkeyup="buscarClientes(this.value)">
            <i class="bi bi-search search-icon"></i>
        </div>

        <!-- Dock Interno de Módulos -->
        <div class="internal-dock">
            <div class="dock-item active" onclick="abrirVentana('clientes')">
                <i class="bi bi-people"></i>
                <span>Mis Clientes</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('conexion')">
                <i class="bi bi-microsoft"></i>
                <span>Conexión 365</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('categorias')">
                <i class="bi bi-tags"></i>
                <span>Categorías</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('actividad')">
                <i class="bi bi-graph-up"></i>
                <span>Actividad</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('importar')">
                <i class="bi bi-cloud-download"></i>
                <span>Sincronizar</span>
            </div>
        </div>

        <!-- Contenedor de Ventanas -->
        <div class="windows-container">
            <!-- Ventana: Lista de Clientes desde Microsoft 365 -->
            <div id="ventana-clientes" class="ubuntu-window window animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-people"></i>
                        <span>Mis Clientes (Microsoft 365)</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('clientes')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('clientes')"></div>
                        <div class="window-control close" onclick="cerrarVentana('clientes')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <!-- Estadísticas Rápidas -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="ubuntu-glass p-4 text-center">
                            <div class="text-2xl font-bold text-blue-400" id="totalClientes">0</div>
                            <div class="text-sm text-gray-400">Total Clientes</div>
                        </div>
                        <div class="ubuntu-glass p-4 text-center">
                            <div class="text-2xl font-bold text-green-400" id="clientesActivos">0</div>
                            <div class="text-sm text-gray-400">Activos</div>
                        </div>
                        <div class="ubuntu-glass p-4 text-center">
                            <div class="text-2xl font-bold text-purple-400" id="empresasCount">0</div>
                            <div class="text-sm text-gray-400">Empresas</div>
                        </div>
                        <div class="ubuntu-glass p-4 text-center">
                            <div class="text-2xl font-bold text-orange-400" id="ultimaSincronizacion">-</div>
                            <div class="text-sm text-gray-400">Última Sinc.</div>
                        </div>
                    </div>

                    <!-- Lista de Clientes desde Microsoft 365 -->
                    <div class="space-y-3" id="listaClientes">
                        <!-- Los clientes se cargan aquí dinámicamente desde Microsoft 365 -->
                        <div class="text-center py-12 text-gray-400">
                            <i class="bi bi-cloud-slash text-4xl mb-4"></i>
                            <p class="text-lg mb-2">No hay clientes cargados</p>
                            <p class="text-sm">Conecta con Microsoft 365 para ver tus clientes</p>
                            <button onclick="abrirVentana('conexion')" class="ubuntu-btn ubuntu-btn-primary mt-4">
                                <i class="bi bi-plug"></i> Conectar Microsoft 365
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ventana: Conexión Microsoft 365 -->
            <div id="ventana-conexion" class="ubuntu-window window hidden animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-microsoft"></i>
                        <span>Conexión Microsoft 365</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('conexion')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('conexion')"></div>
                        <div class="window-control close" onclick="cerrarVentana('conexion')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <!-- Estado de Conexión -->
                    <div class="ubuntu-glass p-4 mb-6" id="conexionStatus">
                        <h4 class="font-medium text-gray-300 mb-3">Estado de Conexión:</h4>
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
                            <span class="text-red-400">⏳ No conectado a Microsoft 365</span>
                        </div>
                        <p class="text-sm text-gray-400">
                            Conecta tu cuenta de Microsoft 365 Business para acceder a tus clientes.
                        </p>
                    </div>

                    <!-- Información del Usuario (cuando esté conectado) -->
                    <div class="ubuntu-glass p-4 mb-6 hidden" id="userInfoSection">
                        <h4 class="font-medium text-gray-300 mb-3">Cuenta Conectada:</h4>
                        <div class="flex items-center gap-3 mb-2">
                            <i class="bi bi-person-circle text-blue-400 text-xl"></i>
                            <div>
                                <div class="font-medium" id="userDisplayName">-</div>
                                <div class="text-sm text-gray-400" id="userEmail">-</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400 mt-2">
                            <strong>Última sincronización:</strong> <span id="lastSyncTime">Nunca</span>
                        </div>
                    </div>

                    <!-- Estadísticas de Sincronización -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 hidden" id="statsSection">
                        <div class="ubuntu-glass p-4">
                            <div class="text-lg font-bold text-green-400" id="contactosCount">0</div>
                            <div class="text-sm text-gray-400">Contactos en 365</div>
                        </div>
                        <div class="ubuntu-glass p-4">
                            <div class="text-lg font-bold text-blue-400" id="categoriasCount">0</div>
                            <div class="text-sm text-gray-400">Categorías</div>
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="flex gap-3 flex-wrap">
                        <button onclick="conectarMicrosoft365()" class="ubuntu-btn ubuntu-btn-primary" id="btnConectar">
                            <i class="bi bi-plug"></i> Conectar Microsoft 365
                        </button>
                        <button onclick="sincronizarClientes()" class="ubuntu-btn bg-blue-500 bg-opacity-20 text-blue-400 border-blue-500 border-opacity-30" id="btnSincronizar" disabled>
                            <i class="bi bi-arrow-repeat"></i> Sincronizar Clientes
                        </button>
                        <button onclick="actualizarEstadisticas()" class="ubuntu-btn bg-green-500 bg-opacity-20 text-green-400 border-green-500 border-opacity-30" id="btnActualizar" disabled>
                            <i class="bi bi-graph-up"></i> Actualizar Stats
                        </button>
                        <button onclick="cerrarSesionMicrosoft()" class="ubuntu-btn bg-red-500 bg-opacity-20 text-red-400 border-red-500 border-opacity-30 hidden" id="btnDesconectar">
                            <i class="bi bi-plug"></i> Desconectar
                        </button>
                    </div>

                    <!-- Información de Sincronización -->
                    <div class="ubuntu-glass p-4 mt-6 hidden" id="syncInfo">
                        <h5 class="font-medium text-gray-300 mb-3">Información de Sincronización</h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Clientes sincronizados:</span>
                                <span class="text-white" id="syncClientesCount">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Empresas detectadas:</span>
                                <span class="text-white" id="syncEmpresasCount">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Última actualización:</span>
                                <span class="text-white" id="syncLastUpdate">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ventana: Categorías de Clientes -->
            <div id="ventana-categorias" class="ubuntu-window window hidden animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-tags"></i>
                        <span>Categorías de Clientes</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('categorias')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('categorias')"></div>
                        <div class="window-control close" onclick="cerrarVentana('categorias')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="text-center py-12 text-gray-400">
                        <i class="bi bi-tags text-4xl mb-4"></i>
                        <p class="text-lg mb-2">Categorías de Clientes</p>
                        <p class="text-sm">Organiza tus clientes en categorías para mejor gestión</p>
                        <button onclick="crearNuevaCategoria()" class="ubuntu-btn ubuntu-btn-primary mt-4">
                            <i class="bi bi-plus-circle"></i> Nueva Categoría
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ventana: Actividad de Clientes -->
            <div id="ventana-actividad" class="ubuntu-window window hidden animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-graph-up"></i>
                        <span>Actividad de Clientes</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('actividad')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('actividad')"></div>
                        <div class="window-control close" onclick="cerrarVentana('actividad')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="text-center py-12 text-gray-400">
                        <i class="bi bi-graph-up text-4xl mb-4"></i>
                        <p class="text-lg mb-2">Actividad de Clientes</p>
                        <p class="text-sm">Visualiza la actividad y engagement de tus clientes</p>
                    </div>
                </div>
            </div>

            <!-- Ventana: Sincronización Avanzada -->
            <div id="ventana-importar" class="ubuntu-window window hidden animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-cloud-download"></i>
                        <span>Sincronización Avanzada</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('importar')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('importar')"></div>
                        <div class="window-control close" onclick="cerrarVentana('importar')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="text-center py-12 text-gray-400">
                        <i class="bi bi-cloud-download text-4xl mb-4"></i>
                        <p class="text-lg mb-2">Sincronización Avanzada</p>
                        <p class="text-sm">Configura sincronizaciones automáticas y reglas de importación</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="../js/auth-system.js"></script>
    <script src="../js/database-manager.js"></script>
    <script src="../js/microsoft-graph.js"></script>
    <script src="../js/clientes-manager.js"></script>

</body>
</html>