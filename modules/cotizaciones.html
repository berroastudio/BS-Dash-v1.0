<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizaciones - BS Dash Ubuntu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Estilos Ubuntu */
        :root {
            --ubuntu-dark: #2D0922;
            --ubuntu-purple: #77216F;
            --ubuntu-orange: #E95420;
            --ubuntu-light: #AEA79F;
            --ubuntu-text: #FFFFFF;
        }

        .ubuntu-dark-theme {
            background: linear-gradient(135deg, var(--ubuntu-dark) 0%, #1a0a15 100%);
            color: var(--ubuntu-text);
            min-height: 100vh;
            font-family: 'Ubuntu', sans-serif;
        }

        .ubuntu-top-bar {
            background: rgba(45, 9, 34, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--ubuntu-purple);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .ubuntu-window {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(119, 33, 111, 0.3);
            border-radius: 12px;
            margin: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .ubuntu-window-header {
            background: linear-gradient(135deg, var(--ubuntu-purple), #5c1a5a);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ubuntu-window-controls {
            display: flex;
            gap: 8px;
        }

        .ubuntu-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .ubuntu-control.close { background: #ff5f57; }
        .ubuntu-control.minimize { background: #ffbd2e; }
        .ubuntu-control.maximize { background: #28ca42; }

        .ubuntu-window-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ubuntu-window-content {
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .ubuntu-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .ubuntu-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .ubuntu-btn-primary {
            background: linear-gradient(135deg, var(--ubuntu-orange), #ff6b35);
            border-color: var(--ubuntu-orange);
        }

        .ubuntu-btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-color: #20c997;
        }

        .ubuntu-btn-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            border-color: #dc3545;
        }

        .ubuntu-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .ubuntu-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .ubuntu-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .ubuntu-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .ubuntu-orange { color: var(--ubuntu-orange); }
        .ubuntu-purple { color: var(--ubuntu-purple); }
        .ubuntu-green { color: #20c997; }
        .ubuntu-blue { color: #17a2b8; }

        .bg-ubuntu-orange { background: var(--ubuntu-orange); }
        .bg-ubuntu-purple { background: var(--ubuntu-purple); }
        .bg-ubuntu-green { background: #20c997; }
        .bg-ubuntu-blue { background: #17a2b8; }

        .ubuntu-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        .ubuntu-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .ubuntu-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .ubuntu-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ubuntu-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ubuntu-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ubuntu-main-content {
            margin-top: 60px;
            padding: 20px;
        }

        .ubuntu-toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .ubuntu-badge {
            background: var(--ubuntu-orange);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .ubuntu-chip {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .ubuntu-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .ubuntu-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .ubuntu-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 24px;
        }

        .ubuntu-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .ubuntu-slider {
            background-color: var(--ubuntu-orange);
        }

        input:checked + .ubuntu-slider:before {
            transform: translateX(26px);
        }

        .ubuntu-tab-container {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .ubuntu-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .ubuntu-tab.active {
            border-bottom-color: var(--ubuntu-orange);
            color: var(--ubuntu-orange);
        }

        .ubuntu-tab-content {
            display: none;
        }

        .ubuntu-tab-content.active {
            display: block;
        }

        .item-cotizacion {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .preview-cotizacion {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 8px;
            font-family: Arial, sans-serif;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="ubuntu-dark-theme">
    <!-- Top Bar Ubuntu -->
    <div class="ubuntu-top-bar">
        <div class="ubuntu-top-left">
            <div class="ubuntu-apps-menu">
                <i class="bi bi-grid-3x3-gap"></i>
            </div>
            <div class="ubuntu-breadcrumb">
                <span>BS Dash</span>
                <i class="bi bi-chevron-right"></i>
                <span>Cotizaciones</span>
            </div>
        </div>
        <div class="ubuntu-top-center">
            <div class="ubuntu-search">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Buscar en cotizaciones..." class="ubuntu-input" style="width: 300px;" id="searchGlobalCotizaciones">
            </div>
        </div>
        <div class="ubuntu-top-right">
            <div class="ubuntu-system-tray">
                <i class="bi bi-wifi"></i>
                <i class="bi bi-battery-half"></i>
                <span id="ubuntu-time">14:30</span>
                <i class="bi bi-person-circle"></i>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="ubuntu-main-content">
        <!-- Ventana Principal de Cotizaciones -->
        <div class="ubuntu-window">
            <div class="ubuntu-window-header">
                <div class="ubuntu-window-controls">
                    <div class="ubuntu-control close" onclick="window.history.back()"></div>
                    <div class="ubuntu-control minimize"></div>
                    <div class="ubuntu-control maximize"></div>
                </div>
                <div class="ubuntu-window-title">
                    <i class="bi bi-file-text ubuntu-green"></i>
                    Gesti√≥n de Cotizaciones - Dashboard Avanzado
                </div>
                <div class="ubuntu-window-actions">
                    <a href="../dashboard.html" class="ubuntu-btn">
                        <i class="bi bi-arrow-left"></i>
                        Volver al Dashboard
                    </a>
                </div>
            </div>

            <div class="ubuntu-window-content">
                <!-- Estad√≠sticas R√°pidas -->
                <div class="ubuntu-stats-grid">
                    <div class="ubuntu-stat-card animate-fade-in">
                        <div class="ubuntu-stat-icon bg-ubuntu-orange">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div class="ubuntu-stat-info">
                            <h3 id="cotizacionesPendientes">8</h3>
                            <p>Cotizaciones Pendientes</p>
                        </div>
                    </div>
                    
                    <div class="ubuntu-stat-card animate-fade-in" style="animation-delay: 0.1s;">
                        <div class="ubuntu-stat-icon bg-ubuntu-purple">
                            <i class="bi bi-currency-dollar"></i>
                        </div>
                        <div class="ubuntu-stat-info">
                            <h3 id="valorPendiente">$23,450</h3>
                            <p>Valor Pendiente</p>
                        </div>
                    </div>
                    
                    <div class="ubuntu-stat-card animate-fade-in" style="animation-delay: 0.2s;">
                        <div class="ubuntu-stat-icon bg-ubuntu-green">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="ubuntu-stat-info">
                            <h3 id="cotizacionesAceptadas">15</h3>
                            <p>Aceptadas Este Mes</p>
                        </div>
                    </div>
                    
                    <div class="ubuntu-stat-card animate-fade-in" style="animation-delay: 0.3s;">
                        <div class="ubuntu-stat-icon bg-ubuntu-blue">
                            <i class="bi bi-graph-up-arrow"></i>
                        </div>
                        <div class="ubuntu-stat-info">
                            <h3 id="tasaConversion">68%</h3>
                            <p>Tasa de Conversi√≥n</p>
                        </div>
                    </div>
                </div>

                <!-- Barra de Herramientas Avanzadas -->
                <div class="ubuntu-toolbar">
                    <button class="ubuntu-btn ubuntu-btn-primary" onclick="mostrarModalNuevaCotizacion()">
                        <i class="bi bi-plus-circle"></i>
                        Nueva Cotizaci√≥n R√°pida
                    </button>
                    <button class="ubuntu-btn" onclick="toggleAdvancedFilters()">
                        <i class="bi bi-funnel"></i>
                        Filtros Avanzados
                    </button>
                    <button class="ubuntu-btn" onclick="showBulkActions()">
                        <i class="bi bi-collection"></i>
                        Acciones Masivas
                    </button>
                    <button class="ubuntu-btn" onclick="showCotizacionTemplates()">
                        <i class="bi bi-file-earmark"></i>
                        Plantillas
                    </button>
                    <button class="ubuntu-btn" onclick="showAutomationRules()">
                        <i class="bi bi-gear"></i>
                        Automatizaci√≥n
                    </button>
                    <button class="ubuntu-btn" onclick="showAnalytics()">
                        <i class="bi bi-graph-up"></i>
                        Analytics
                    </button>
                    <div class="flex-1"></div>
                    <button class="ubuntu-btn ubuntu-btn-success" onclick="exportarCotizacionesExcel()">
                        <i class="bi bi-file-earmark-excel"></i>
                        Excel
                    </button>
                    <button class="ubuntu-btn ubuntu-btn-danger" onclick="exportarCotizacionesPDF()">
                        <i class="bi bi-file-earmark-pdf"></i>
                        PDF
                    </button>
                    <button class="ubuntu-btn" onclick="sincronizarCotizaciones()">
                        <i class="bi bi-cloud-arrow-down"></i>
                        Sincronizar
                    </button>
                </div>

                <!-- Filtros Avanzados -->
                <div id="advancedFilters" class="glass-effect p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm mb-2">Buscar Live</label>
                            <input type="text" id="searchCotizaciones" placeholder="Buscar cotizaciones..." 
                                   class="ubuntu-input" onkeyup="filtrarCotizaciones()">
                        </div>
                        <div>
                            <label class="block text-sm mb-2">Desde</label>
                            <input type="date" id="fechaDesde" class="ubuntu-input" onchange="filtrarCotizaciones()">
                        </div>
                        <div>
                            <label class="block text-sm mb-2">Hasta</label>
                            <input type="date" id="fechaHasta" class="ubuntu-input" onchange="filtrarCotizaciones()">
                        </div>
                        <div>
                            <label class="block text-sm mb-2">Estado</label>
                            <select id="estadoFilter" class="ubuntu-input" onchange="filtrarCotizaciones()">
                                <option value="">Todos</option>
                                <option value="pendiente">Pendientes</option>
                                <option value="enviada">Enviadas</option>
                                <option value="aceptada">Aceptadas</option>
                                <option value="rechazada">Rechazadas</option>
                                <option value="expirada">Expiradas</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm mb-2">Cliente</label>
                            <select id="clienteFilter" class="ubuntu-input" onchange="filtrarCotizaciones()">
                                <option value="">Todos los clientes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm mb-2">Vendedor</label>
                            <select id="vendedorFilter" class="ubuntu-input" onchange="filtrarCotizaciones()">
                                <option value="">Todos</option>
                                <option value="vendedor1">Vendedor A</option>
                                <option value="vendedor2">Vendedor B</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm mb-2">Monto M√≠nimo</label>
                            <input type="number" id="montoMinimo" class="ubuntu-input" placeholder="0.00" onchange="filtrarCotizaciones()">
                        </div>
                    </div>
                </div>

                <!-- Vista de Tarjetas de Cotizaciones -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6" id="cotizacionesCardView">
                    <!-- Las cotizaciones se mostrar√°n aqu√≠ como tarjetas -->
                </div>

                <!-- Vista de Tabla (Alternativa) -->
                <div class="ubuntu-window">
                    <div class="ubuntu-window-header">
                        <div class="ubuntu-window-title">
                            <i class="bi bi-table ubuntu-blue"></i>
                            Vista de Tabla - Cotizaciones
                        </div>
                        <div class="ubuntu-window-actions">
                            <button class="ubuntu-btn" onclick="toggleView()">
                                <i class="bi bi-layout-three-columns"></i>
                                Cambiar Vista
                            </button>
                        </div>
                    </div>
                    <div class="ubuntu-window-content">
                        <table class="ubuntu-table">
                            <thead>
                                <tr>
                                    <th>N¬∞ Cotizaci√≥n</th>
                                    <th>Cliente</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Vendedor</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaCotizaciones">
                                <!-- Las cotizaciones se cargar√°n aqu√≠ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Panel de Analytics en Tiempo Real -->
                <div class="ubuntu-window mt-4">
                    <div class="ubuntu-window-header">
                        <div class="ubuntu-window-title">
                            <i class="bi bi-graph-up-arrow ubuntu-green"></i>
                            Analytics en Tiempo Real
                        </div>
                    </div>
                    <div class="ubuntu-window-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <canvas id="cotizacionesChart" width="400" height="200"></canvas>
                            </div>
                            <div>
                                <canvas id="estadoChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Cotizaci√≥n Avanzada -->
    <div id="modalCotizacion" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="ubuntu-window w-full max-w-6xl max-h-[95vh] overflow-hidden">
            <div class="ubuntu-window-header">
                <div class="ubuntu-window-title">
                    <i class="bi bi-plus-circle ubuntu-orange"></i>
                    <span id="tituloModalCotizacion">Nueva Cotizaci√≥n Avanzada</span>
                </div>
                <div class="ubuntu-window-actions">
                    <button onclick="cerrarModalCotizacion()" class="ubuntu-btn">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
            </div>
            <div class="ubuntu-window-content overflow-y-auto">
                <form id="formCotizacion" class="space-y-6">
                    <!-- Informaci√≥n General -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="ubuntu-window">
                            <div class="ubuntu-window-header">
                                <div class="ubuntu-window-title">
                                    <i class="bi bi-info-circle ubuntu-blue"></i>
                                    Informaci√≥n General
                                </div>
                            </div>
                            <div class="ubuntu-window-content space-y-4">
                                <div>
                                    <label class="block text-sm mb-2">Cliente *</label>
                                    <select id="cotizacionCliente" class="ubuntu-input w-full" required>
                                        <option value="">Seleccionar cliente...</option>
                                        <option value="1">Ana Garc√≠a</option>
                                        <option value="2">Carlos L√≥pez</option>
                                        <option value="3">Mar√≠a Rodr√≠guez</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Fecha Emisi√≥n</label>
                                    <input type="date" id="cotizacionFecha" class="ubuntu-input w-full" value="">
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Fecha Vencimiento *</label>
                                    <input type="date" id="cotizacionVencimiento" class="ubuntu-input w-full" required>
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">V√°lido por (d√≠as)</label>
                                    <input type="number" id="cotizacionValidez" class="ubuntu-input w-full" value="30" min="1">
                                </div>
                            </div>
                        </div>

                        <div class="ubuntu-window">
                            <div class="ubuntu-window-header">
                                <div class="ubuntu-window-title">
                                    <i class="bi bi-chat-text ubuntu-purple"></i>
                                    Detalles Adicionales
                                </div>
                            </div>
                            <div class="ubuntu-window-content space-y-4">
                                <div>
                                    <label class="block text-sm mb-2">T√≠tulo de la Cotizaci√≥n</label>
                                    <input type="text" id="cotizacionTitulo" class="ubuntu-input w-full" placeholder="Ej: Desarrollo Web Corporativo">
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Referencia/Proyecto</label>
                                    <input type="text" id="cotizacionReferencia" class="ubuntu-input w-full" placeholder="N√∫mero de referencia interna">
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Condiciones de Pago</label>
                                    <select id="cotizacionCondiciones" class="ubuntu-input w-full">
                                        <option value="contado">Contado</option>
                                        <option value="30dias">30 D√≠as</option>
                                        <option value="50-50">50% Anticipo - 50% Entrega</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Notas</label>
                                    <textarea id="cotizacionNotas" class="ubuntu-input w-full" rows="3" placeholder="Notas adicionales..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Items de la Cotizaci√≥n -->
                    <div class="ubuntu-window">
                        <div class="ubuntu-window-header">
                            <div class="ubuntu-window-title">
                                <i class="bi bi-list-check ubuntu-green"></i>
                                Productos/Servicios
                            </div>
                            <button type="button" onclick="agregarItem()" class="ubuntu-btn ubuntu-btn-primary">
                                <i class="bi bi-plus"></i> Agregar Item
                            </button>
                        </div>
                        <div class="ubuntu-window-content">
                            <div class="space-y-3" id="itemsCotizacion">
                                <!-- Los items se agregar√°n aqu√≠ din√°micamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Totales y Resumen -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="ubuntu-window">
                            <div class="ubuntu-window-header">
                                <div class="ubuntu-window-title">
                                    <i class="bi bi-calculator ubuntu-orange"></i>
                                    Resumen de Totales
                                </div>
                            </div>
                            <div class="ubuntu-window-content">
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span>Subtotal:</span>
                                        <span class="font-semibold" id="subtotalCotizacion">$0.00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Descuento:</span>
                                        <span class="font-semibold" id="descuentoCotizacion">$0.00</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>IVA (18%):</span>
                                        <span class="font-semibold" id="ivaCotizacion">$0.00</span>
                                    </div>
                                    <div class="flex justify-between border-t pt-2 text-lg font-bold">
                                        <span>Total:</span>
                                        <span id="totalCotizacion">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ubuntu-window">
                            <div class="ubuntu-window-header">
                                <div class="ubuntu-window-title">
                                    <i class="bi bi-eye ubuntu-purple"></i>
                                    Vista Previa R√°pida
                                </div>
                            </div>
                            <div class="ubuntu-window-content">
                                <div class="preview-cotizacion text-sm">
                                    <div class="text-center mb-4">
                                        <h3 class="text-xl font-bold" id="previewEmpresa">BERROA STUDIO S.R.L.</h3>
                                        <p id="previewEslogan">Soluciones digitales innovadoras</p>
                                    </div>
                                    <div class="border-b pb-2 mb-2">
                                        <strong>COTIZACI√ìN: </strong><span id="previewNumero">COT-001-2024</span>
                                    </div>
                                    <div id="previewCliente">Cliente: [Seleccionar cliente]</div>
                                    <div class="mt-4" id="previewItems">
                                        [Items aparecer√°n aqu√≠]
                                    </div>
                                    <div class="text-right mt-4">
                                        <strong>TOTAL: </strong><span id="previewTotal">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="flex gap-3 justify-end pt-4">
                        <button type="button" onclick="cerrarModalCotizacion()" class="ubuntu-btn">Cancelar</button>
                        <button type="button" onclick="guardarBorrador()" class="ubuntu-btn">
                            <i class="bi bi-save"></i> Guardar Borrador
                        </button>
                        <button type="button" onclick="previsualizarCotizacion()" class="ubuntu-btn">
                            <i class="bi bi-eye"></i> Vista Previa Completa
                        </button>
                        <button type="submit" class="ubuntu-btn ubuntu-btn-primary">
                            <i class="bi bi-send"></i> Enviar Cotizaci√≥n
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Ver/Imprimir Cotizaci√≥n -->
    <div id="modalVerCotizacion" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="ubuntu-window w-full max-w-4xl max-h-[95vh] overflow-hidden">
            <div class="ubuntu-window-header">
                <div class="ubuntu-window-title">
                    <i class="bi bi-file-text ubuntu-green"></i>
                    Cotizaci√≥n <span id="numeroCotizacionVer"></span>
                </div>
                <div class="ubuntu-window-actions">
                    <button onclick="imprimirCotizacion()" class="ubuntu-btn">
                        <i class="bi bi-printer"></i> Imprimir
                    </button>
                    <button onclick="cerrarModalVerCotizacion()" class="ubuntu-btn">
                        <i class="bi bi-x"></i> Cerrar
                    </button>
                </div>
            </div>
            <div class="ubuntu-window-content overflow-y-auto">
                <div id="contenidoCotizacion" class="preview-cotizacion">
                    <!-- Contenido de la cotizaci√≥n se generar√° aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/config-loader.js"></script>
    <script src="../js/secure-database.js"></script>
    <script src="../js/auth-system.js"></script>
    <script src="../js/database-manager.js"></script>
    <script src="../js/empresa-context.js"></script>
    <script src="../js/auth-checker.js"></script>

    <script>
        // Variables globales
        let todasLasCotizaciones = [];
        let cotizacionesFiltradas = [];
        let currentView = 'table'; // 'table' o 'cards'
        let cotizacionesChart, estadoChart;
        let currentEditingId = null;
        let itemCounter = 0;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', async function() {
            const authCheck = await window.authChecker.initializeModule('Cotizaciones');
            
            if (authCheck) {
                inicializarModuloCotizaciones();
                cargarDatosIniciales();
                configurarFechasPorDefecto();
                inicializarGraficos();
                actualizarHora();
            }
        });

        function actualizarHora() {
            const ahora = new Date();
            document.getElementById('ubuntu-time').textContent = 
                ahora.getHours().toString().padStart(2, '0') + ':' + 
                ahora.getMinutes().toString().padStart(2, '0');
            setTimeout(actualizarHora, 60000);
        }

        function inicializarModuloCotizaciones() {
            console.log('üöÄ Inicializando m√≥dulo de cotizaciones avanzado...');
            
            // Configurar fecha por defecto (mes actual)
            const hoy = new Date();
            const inicioMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
            
            document.getElementById('fechaDesde').value = inicioMes.toISOString().split('T')[0];
            document.getElementById('fechaHasta').value = hoy.toISOString().split('T')[0];
            
            // Configurar fecha de vencimiento por defecto (30 d√≠as)
            const vencimiento = new Date();
            vencimiento.setDate(vencimiento.getDate() + 30);
            document.getElementById('cotizacionVencimiento').value = vencimiento.toISOString().split('T')[0];
            document.getElementById('cotizacionFecha').value = hoy.toISOString().split('T')[0];
        }

        function cargarDatosIniciales() {
            if (!window.dbManager) {
                console.error('‚ùå dbManager no disponible');
                // Datos de ejemplo para demo
                todasLasCotizaciones = generarDatosEjemplo();
            } else {
                todasLasCotizaciones = window.dbManager.getCotizaciones() || generarDatosEjemplo();
            }

            cotizacionesFiltradas = [...todasLasCotizaciones];
            mostrarCotizaciones();
            actualizarEstadisticas();
        }

        function generarDatosEjemplo() {
            const estados = ['pendiente', 'enviada', 'aceptada', 'rechazada', 'expirada'];
            const clientes = [
                {id: 1, nombre: 'Ana Garc√≠a'},
                {id: 2, nombre: 'Carlos L√≥pez'}, 
                {id: 3, nombre: 'Mar√≠a Rodr√≠guez'},
                {id: 4, nombre: 'Juan P√©rez'},
                {id: 5, nombre: 'Laura Mart√≠nez'}
            ];
            const vendedores = ['Vendedor A', 'Vendedor B'];

            return Array.from({length: 25}, (_, i) => {
                const cliente = clientes[Math.floor(Math.random() * clientes.length)];
                const estado = estados[Math.floor(Math.random() * estados.length)];
                const fecha = new Date(Date.now() - Math.floor(Math.random() * 60) * 24 * 60 * 60 * 1000);
                const vencimiento = new Date(fecha);
                vencimiento.setDate(vencimiento.getDate() + 30);
                
                return {
                    id: i + 1,
                    numero: `COT-${String(i + 1).padStart(3, '0')}-2024`,
                    cliente_id: cliente.id,
                    cliente_nombre: cliente.nombre,
                    fecha: fecha.toISOString(),
                    vencimiento: vencimiento.toISOString(),
                    total: Math.floor(Math.random() * 10000) + 500,
                    estado: estado,
                    vendedor: vendedores[Math.floor(Math.random() * vendedores.length)],
                    items: Math.floor(Math.random() * 8) + 1,
                    titulo: `Proyecto ${['Web', 'Marketing', 'Dise√±o', 'Desarrollo'][Math.floor(Math.random() * 4)]} ${cliente.nombre.split(' ')[0]}`
                };
            });
        }

        // ==================== FILTRADO AVANZADO ====================
        function filtrarCotizaciones() {
            const filtroTexto = document.getElementById('searchCotizaciones').value.toLowerCase();
            const fechaDesde = document.getElementById('fechaDesde').value;
            const fechaHasta = document.getElementById('fechaHasta').value;
            const estado = document.getElementById('estadoFilter').value;
            const cliente = document.getElementById('clienteFilter').value;
            const vendedor = document.getElementById('vendedorFilter').value;
            const montoMinimo = parseFloat(document.getElementById('montoMinimo').value) || 0;

            cotizacionesFiltradas = todasLasCotizaciones.filter(cotizacion => {
                const coincideTexto = !filtroTexto || 
                    cotizacion.numero.toLowerCase().includes(filtroTexto) ||
                    cotizacion.cliente_nombre.toLowerCase().includes(filtroTexto) ||
                    cotizacion.titulo.toLowerCase().includes(filtroTexto);

                const fechaCotizacion = new Date(cotizacion.fecha);
                const desde = fechaDesde ? new Date(fechaDesde) : new Date('1900-01-01');
                const hasta = fechaHasta ? new Date(fechaHasta) : new Date('2100-01-01');
                const coincideFecha = fechaCotizacion >= desde && fechaCotizacion <= hasta;

                const coincideEstado = !estado || cotizacion.estado === estado;
                const coincideVendedor = !vendedor || cotizacion.vendedor === vendedor;
                const coincideMonto = cotizacion.total >= montoMinimo;

                return coincideTexto && coincideFecha && coincideEstado && coincideVendedor && coincideMonto;
            });

            mostrarCotizaciones();
            actualizarEstadisticas();
            actualizarGraficos();
        }

        function toggleAdvancedFilters() {
            const advancedFilters = document.getElementById('advancedFilters');
            advancedFilters.classList.toggle('hidden');
        }

        // ==================== VISTAS ====================
        function toggleView() {
            currentView = currentView === 'table' ? 'cards' : 'table';
            mostrarCotizaciones();
        }

        function mostrarCotizaciones() {
            if (currentView === 'table') {
                mostrarCotizacionesTabla();
            } else {
                mostrarCotizacionesCards();
            }
        }

        function mostrarCotizacionesTabla() {
            const tbody = document.getElementById('tablaCotizaciones');
            let html = '';

            cotizacionesFiltradas.forEach(cotizacion => {
                const estadoColor = {
                    'pendiente': 'ubuntu-chip bg-yellow-500/20',
                    'enviada': 'ubuntu-chip bg-blue-500/20',
                    'aceptada': 'ubuntu-chip bg-green-500/20',
                    'rechazada': 'ubuntu-chip bg-red-500/20',
                    'expirada': 'ubuntu-chip bg-gray-500/20'
                }[cotizacion.estado];

                const estadoTexto = {
                    'pendiente': 'Pendiente',
                    'enviada': 'Enviada', 
                    'aceptada': 'Aceptada',
                    'rechazada': 'Rechazada',
                    'expirada': 'Expirada'
                }[cotizacion.estado];

                html += `
                    <tr class="hover:bg-white/5">
                        <td class="font-mono">${cotizacion.numero}</td>
                        <td>
                            <div class="font-medium">${cotizacion.cliente_nombre}</div>
                            <div class="text-sm opacity-70">${cotizacion.titulo}</div>
                        </td>
                        <td class="text-sm">${new Date(cotizacion.fecha).toLocaleDateString()}</td>
                        <td class="text-sm ${new Date(cotizacion.vencimiento) < new Date() ? 'text-red-400' : ''}">
                            ${new Date(cotizacion.vencimiento).toLocaleDateString()}
                        </td>
                        <td class="font-bold text-green-400">$${cotizacion.total.toFixed(2)}</td>
                        <td><span class="${estadoColor}">${estadoTexto}</span></td>
                        <td class="text-sm">${cotizacion.vendedor}</td>
                        <td>
                            <div class="flex gap-1">
                                <button onclick="verCotizacion(${cotizacion.id})" class="ubuntu-btn text-sm">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button onclick="editarCotizacion(${cotizacion.id})" class="ubuntu-btn text-sm">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button onclick="duplicarCotizacion(${cotizacion.id})" class="ubuntu-btn text-sm">
                                    <i class="bi bi-copy"></i>
                                </button>
                                <button onclick="enviarCotizacion(${cotizacion.id})" class="ubuntu-btn text-sm ubuntu-btn-success">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function mostrarCotizacionesCards() {
            const container = document.getElementById('cotizacionesCardView');
            let html = '';

            cotizacionesFiltradas.forEach(cotizacion => {
                const estadoColor = {
                    'pendiente': 'border-yellow-500',
                    'enviada': 'border-blue-500',
                    'aceptada': 'border-green-500',
                    'rechazada': 'border-red-500',
                    'expirada': 'border-gray-500'
                }[cotizacion.estado];

                const estaVencida = new Date(cotizacion.vencimiento) < new Date();

                html += `
                    <div class="ubuntu-stat-card border-l-4 ${estadoColor} ${estaVencida ? 'opacity-75' : ''}">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">${cotizacion.numero}</h3>
                                <p class="text-sm opacity-70">${cotizacion.cliente_nombre}</p>
                                <p class="text-xs opacity-50">${cotizacion.titulo}</p>
                            </div>
                            <span class="ubuntu-badge">$${cotizacion.total.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-3">
                            <span class="ubuntu-chip">${cotizacion.estado}</span>
                            <span>${cotizacion.items} items</span>
                        </div>
                        <div class="flex justify-between items-center text-xs opacity-70 mb-2">
                            <span>Emisi√≥n: ${new Date(cotizacion.fecha).toLocaleDateString()}</span>
                            <span class="${estaVencida ? 'text-red-400' : ''}">Vence: ${new Date(cotizacion.vencimiento).toLocaleDateString()}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs opacity-70">${cotizacion.vendedor}</span>
                            <div class="flex gap-1">
                                <button onclick="verCotizacion(${cotizacion.id})" class="ubuntu-btn text-xs">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button onclick="editarCotizacion(${cotizacion.id})" class="ubuntu-btn text-xs">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button onclick="enviarCotizacion(${cotizacion.id})" class="ubuntu-btn text-xs ubuntu-btn-success">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ==================== MODALES Y FORMULARIOS ====================
        function mostrarModalNuevaCotizacion() {
            currentEditingId = null;
            document.getElementById('tituloModalCotizacion').textContent = 'Nueva Cotizaci√≥n Avanzada';
            document.getElementById('formCotizacion').reset();
            document.getElementById('itemsCotizacion').innerHTML = '';
            itemCounter = 0;
            
            // Agregar un item por defecto
            agregarItem();
            
            document.getElementById('modalCotizacion').classList.remove('hidden');
            document.getElementById('modalCotizacion').classList.add('flex');
            actualizarTotales();
        }

        function cerrarModalCotizacion() {
            document.getElementById('modalCotizacion').classList.add('hidden');
            document.getElementById('modalCotizacion').classList.remove('flex');
        }

        function agregarItem() {
            itemCounter++;
            const itemsContainer = document.getElementById('itemsCotizacion');
            const itemHtml = `
                <div class="item-cotizacion" id="item-${itemCounter}">
                    <div class="grid grid-cols-12 gap-3">
                        <div class="col-span-5">
                            <input type="text" class="ubuntu-input" placeholder="Descripci√≥n del producto/servicio" 
                                   onchange="actualizarTotales()">
                        </div>
                        <div class="col-span-2">
                            <input type="number" class="ubuntu-input" placeholder="Cantidad" value="1" min="1" 
                                   onchange="actualizarTotales()">
                        </div>
                        <div class="col-span-2">
                            <input type="number" class="ubuntu-input" placeholder="Precio" step="0.01" 
                                   onchange="actualizarTotales()">
                        </div>
                        <div class="col-span-2">
                            <input type="number" class="ubuntu-input" placeholder="Desc. %" value="0" min="0" max="100" 
                                   onchange="actualizarTotales()">
                        </div>
                        <div class="col-span-1">
                            <button type="button" onclick="eliminarItem(${itemCounter})" class="ubuntu-btn ubuntu-btn-danger w-full">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            itemsContainer.innerHTML += itemHtml;
            actualizarTotales();
        }

        function eliminarItem(id) {
            const item = document.getElementById(`item-${id}`);
            if (item) {
                item.remove();
                actualizarTotales();
            }
        }

        function actualizarTotales() {
            let subtotal = 0;
            const items = document.querySelectorAll('.item-cotizacion');
            
            items.forEach(item => {
                const cantidad = parseFloat(item.querySelector('input[placeholder="Cantidad"]').value) || 0;
                const precio = parseFloat(item.querySelector('input[placeholder="Precio"]').value) || 0;
                const descuento = parseFloat(item.querySelector('input[placeholder="Desc. %"]').value) || 0;
                
                const totalItem = cantidad * precio;
                const descuentoMonto = totalItem * (descuento / 100);
                subtotal += totalItem - descuentoMonto;
            });

            const iva = subtotal * 0.18;
            const total = subtotal + iva;

            document.getElementById('subtotalCotizacion').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('ivaCotizacion').textContent = `$${iva.toFixed(2)}`;
            document.getElementById('totalCotizacion').textContent = `$${total.toFixed(2)}`;

            // Actualizar vista previa
            document.getElementById('previewTotal').textContent = `$${total.toFixed(2)}`;
        }

        // ==================== FUNCIONES DE COTIZACI√ìN ====================
        function verCotizacion(id) {
            const cotizacion = todasLasCotizaciones.find(c => c.id === id);
            if (cotizacion) {
                document.getElementById('numeroCotizacionVer').textContent = cotizacion.numero;
                
                // Generar contenido de la cotizaci√≥n
                const contenido = generarContenidoCotizacion(cotizacion);
                document.getElementById('contenidoCotizacion').innerHTML = contenido;
                
                document.getElementById('modalVerCotizacion').classList.remove('hidden');
                document.getElementById('modalVerCotizacion').classList.add('flex');
            }
        }

        function editarCotizacion(id) {
            const cotizacion = todasLasCotizaciones.find(c => c.id === id);
            if (cotizacion) {
                currentEditingId = id;
                document.getElementById('tituloModalCotizacion').textContent = `Editando ${cotizacion.numero}`;
                
                // Cargar datos en el formulario
                document.getElementById('cotizacionCliente').value = cotizacion.cliente_id;
                document.getElementById('cotizacionTitulo').value = cotizacion.titulo || '';
                document.getElementById('cotizacionFecha').value = cotizacion.fecha.split('T')[0];
                document.getElementById('cotizacionVencimiento').value = cotizacion.vencimiento.split('T')[0];
                
                // Mostrar modal
                document.getElementById('modalCotizacion').classList.remove('hidden');
                document.getElementById('modalCotizacion').classList.add('flex');
            }
        }

        function duplicarCotizacion(id) {
            const cotizacion = todasLasCotizaciones.find(c => c.id === id);
            if (cotizacion) {
                const nuevaCotizacion = {
                    ...cotizacion,
                    id: Math.max(...todasLasCotizaciones.map(c => c.id)) + 1,
                    numero: `COT-${String(todasLasCotizaciones.length + 1).padStart(3, '0')}-2024`,
                    fecha: new Date().toISOString(),
                    estado: 'pendiente'
                };
                todasLasCotizaciones.push(nuevaCotizacion);
                filtrarCotizaciones();
                mostrarNotificacion('‚úÖ Cotizaci√≥n duplicada correctamente', 'success');
            }
        }

        function enviarCotizacion(id) {
            const cotizacion = todasLasCotizaciones.find(c => c.id === id);
            if (cotizacion && cotizacion.estado === 'pendiente') {
                cotizacion.estado = 'enviada';
                filtrarCotizaciones();
                mostrarNotificacion(`‚úÖ Cotizaci√≥n ${cotizacion.numero} enviada al cliente`, 'success');
            }
        }

        function guardarBorrador() {
            mostrarNotificacion('üíæ Guardando borrador...', 'info');
            setTimeout(() => {
                mostrarNotificacion('‚úÖ Borrador guardado correctamente', 'success');
            }, 1000);
        }

        function previsualizarCotizacion() {
            const clienteSelect = document.getElementById('cotizacionCliente');
            const clienteTexto = clienteSelect.options[clienteSelect.selectedIndex].text;
            
            document.getElementById('previewCliente').textContent = `Cliente: ${clienteTexto}`;
            document.getElementById('previewNumero').textContent = `COT-${String(todasLasCotizaciones.length + 1).padStart(3, '0')}-2024`;
            
            verCotizacion(currentEditingId || todasLasCotizaciones.length + 1);
        }

        function cerrarModalVerCotizacion() {
            document.getElementById('modalVerCotizacion').classList.add('hidden');
            document.getElementById('modalVerCotizacion').classList.remove('flex');
        }

        function imprimirCotizacion() {
            window.print();
        }

        // ==================== HERRAMIENTAS AVANZADAS ====================
        function showBulkActions() {
            const seleccionadas = cotizacionesFiltradas.filter(c => c.seleccionada);
            if (seleccionadas.length === 0) {
                alert('Selecciona cotizaciones para realizar acciones masivas');
                return;
            }

            const acciones = `
                <div class="space-y-2">
                    <button class="ubuntu-btn w-full" onclick="cambiarEstadoMasivo('enviada')">
                        <i class="bi bi-send"></i> Marcar como Enviadas
                    </button>
                    <button class="ubuntu-btn w-full" onclick="cambiarEstadoMasivo('aceptada')">
                        <i class="bi bi-check-circle"></i> Marcar como Aceptadas
                    </button>
                    <button class="ubuntu-btn w-full ubuntu-btn-danger" onclick="eliminarCotizacionesMasivo()">
                        <i class="bi bi-trash"></i> Eliminar Cotizaciones
                    </button>
                </div>
            `;

            mostrarModalPersonalizado('Acciones Masivas', acciones);
        }

        function showCotizacionTemplates() {
            const plantillas = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="ubuntu-stat-card cursor-pointer" onclick="usarPlantilla('servicio-tecnico')">
                        <i class="bi bi-tools text-2xl ubuntu-blue"></i>
                        <div>
                            <h4 class="font-bold">Servicio T√©cnico</h4>
                            <p class="text-sm">Para reparaciones y mantenimiento</p>
                        </div>
                    </div>
                    <div class="ubuntu-stat-card cursor-pointer" onclick="usarPlantilla('desarrollo-web')">
                        <i class="bi bi-code-slash text-2xl ubuntu-purple"></i>
                        <div>
                            <h4 class="font-bold">Desarrollo Web</h4>
                            <p class="text-sm">Para proyectos de desarrollo</p>
                        </div>
                    </div>
                    <div class="ubuntu-stat-card cursor-pointer" onclick="usarPlantilla('marketing')">
                        <i class="bi bi-megaphone text-2xl ubuntu-orange"></i>
                        <div>
                            <h4 class="font-bold">Marketing Digital</h4>
                            <p class="text-sm">Para campa√±as publicitarias</p>
                        </div>
                    </div>
                    <div class="ubuntu-stat-card cursor-pointer" onclick="crearPlantilla()">
                        <i class="bi bi-plus-circle text-2xl ubuntu-green"></i>
                        <div>
                            <h4 class="font-bold">Nueva Plantilla</h4>
                            <p class="text-sm">Crear desde cero</p>
                        </div>
                    </div>
                </div>
            `;

            mostrarModalPersonalizado('Plantillas de Cotizaciones', plantillas);
        }

        // ==================== GR√ÅFICOS ====================
        function inicializarGraficos() {
            // Gr√°fico de cotizaciones por d√≠a
            const cotizacionesCtx = document.getElementById('cotizacionesChart').getContext('2d');
            cotizacionesChart = new Chart(cotizacionesCtx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                    datasets: [{
                        label: 'Cotizaciones por D√≠a',
                        data: [5, 8, 6, 12, 9, 4, 3],
                        borderColor: '#20c997',
                        backgroundColor: 'rgba(32, 201, 151, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        x: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    }
                }
            });

            // Gr√°fico de estados
            const estadoCtx = document.getElementById('estadoChart').getContext('2d');
            estadoChart = new Chart(estadoCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pendientes', 'Enviadas', 'Aceptadas', 'Rechazadas', 'Expiradas'],
                    datasets: [{
                        data: [8, 12, 15, 5, 3],
                        backgroundColor: [
                            '#FFBD2E',
                            '#17A2B8',
                            '#28A745',
                            '#DC3545',
                            '#6C757D'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'white' }
                        }
                    }
                }
            });
        }

        function actualizarGraficos() {
            // Actualizar datos de los gr√°ficos basado en cotizaciones filtradas
            const datosPorDia = [3, 7, 5, 10, 8, 2, 4]; // Datos de ejemplo
            cotizacionesChart.data.datasets[0].data = datosPorDia;
            cotizacionesChart.update();

            // Actualizar gr√°fico de estados
            const conteoEstados = {
                pendiente: cotizacionesFiltradas.filter(c => c.estado === 'pendiente').length,
                enviada: cotizacionesFiltradas.filter(c => c.estado === 'enviada').length,
                aceptada: cotizacionesFiltradas.filter(c => c.estado === 'aceptada').length,
                rechazada: cotizacionesFiltradas.filter(c => c.estado === 'rechazada').length,
                expirada: cotizacionesFiltradas.filter(c => c.estado === 'expirada').length
            };

            estadoChart.data.datasets[0].data = [
                conteoEstados.pendiente,
                conteoEstados.enviada,
                conteoEstados.aceptada,
                conteoEstados.rechazada,
                conteoEstados.expirada
            ];
            estadoChart.update();
        }

        // ==================== EXPORTACI√ìN ====================
        function exportarCotizacionesExcel() {
            const datos = cotizacionesFiltradas.map(cotizacion => ({
                'N¬∞ Cotizaci√≥n': cotizacion.numero,
                'Cliente': cotizacion.cliente_nombre,
                'Fecha': new Date(cotizacion.fecha).toLocaleDateString(),
                'Vencimiento': new Date(cotizacion.vencimiento).toLocaleDateString(),
                'Total': cotizacion.total,
                'Estado': cotizacion.estado,
                'Vendedor': cotizacion.vendedor
            }));

            const ws = XLSX.utils.json_to_sheet(datos);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Cotizaciones');
            XLSX.writeFile(wb, `cotizaciones_${new Date().toISOString().split('T')[0]}.xlsx`);
            mostrarNotificacion('‚úÖ Excel exportado correctamente', 'success');
        }

        function exportarCotizacionesPDF() {
            const docDefinition = {
                content: [
                    { text: 'Reporte de Cotizaciones - BS Dash', style: 'header' },
                    {
                        table: {
                            headerRows: 1,
                            widths: ['*', '*', '*', '*', '*', '*', '*'],
                            body: [
                                ['N¬∞ Cotizaci√≥n', 'Cliente', 'Fecha', 'Vencimiento', 'Total', 'Estado', 'Vendedor'],
                                ...cotizacionesFiltradas.map(cotizacion => [
                                    cotizacion.numero,
                                    cotizacion.cliente_nombre,
                                    new Date(cotizacion.fecha).toLocaleDateString(),
                                    new Date(cotizacion.vencimiento).toLocaleDateString(),
                                    `$${cotizacion.total.toFixed(2)}`,
                                    cotizacion.estado,
                                    cotizacion.vendedor
                                ])
                            ]
                        }
                    }
                ],
                styles: {
                    header: {
                        fontSize: 18,
                        bold: true,
                        margin: [0, 0, 0, 10]
                    }
                }
            };

            pdfMake.createPdf(docDefinition).download(`cotizaciones_${new Date().toISOString().split('T')[0]}.pdf`);
            mostrarNotificacion('‚úÖ PDF exportado correctamente', 'success');
        }

        function sincronizarCotizaciones() {
            mostrarNotificacion('üîÑ Sincronizando cotizaciones...', 'info');
            setTimeout(() => {
                mostrarNotificacion('‚úÖ Cotizaciones sincronizadas correctamente', 'success');
            }, 2000);
        }

        // ==================== FUNCIONES UTILITARIAS ====================
        function mostrarModalPersonalizado(titulo, contenido) {
            const modal = document.getElementById('modalCotizacion');
            const content = modal.querySelector('.ubuntu-window-content');
            
            modal.querySelector('.ubuntu-window-title').innerHTML = `
                <i class="bi bi-info-circle ubuntu-orange"></i>
                ${titulo}
            `;
            
            content.innerHTML = contenido;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function actualizarEstadisticas() {
            document.getElementById('cotizacionesPendientes').textContent = 
                cotizacionesFiltradas.filter(c => c.estado === 'pendiente').length;
            
            const valorPendiente = cotizacionesFiltradas
                .filter(c => c.estado === 'pendiente')
                .reduce((sum, c) => sum + c.total, 0);
            document.getElementById('valorPendiente').textContent = `$${valorPendiente.toLocaleString()}`;
            
            const aceptadasMes = cotizacionesFiltradas
                .filter(c => c.estado === 'aceptada' && 
                    new Date(c.fecha).getMonth() === new Date().getMonth()).length;
            document.getElementById('cotizacionesAceptadas').textContent = aceptadasMes;
            
            const totalCotizaciones = cotizacionesFiltradas.length;
            const aceptadas = cotizacionesFiltradas.filter(c => c.estado === 'aceptada').length;
            const tasa = totalCotizaciones > 0 ? Math.round((aceptadas / totalCotizaciones) * 100) : 0;
            document.getElementById('tasaConversion').textContent = `${tasa}%`;
        }

        function generarContenidoCotizacion(cotizacion) {
            return `
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold">BERROA STUDIO S.R.L.</h1>
                    <p class="text-gray-600">Soluciones digitales innovadoras</p>
                    <p class="text-sm">RNC: 130785652 | Tel: (809) 555-0199</p>
                </div>
                
                <div class="border-b-2 border-gray-300 pb-4 mb-4">
                    <h2 class="text-xl font-bold text-center">COTIZACI√ìN</h2>
                    <div class="flex justify-between mt-2">
                        <div>
                            <strong>N√∫mero:</strong> ${cotizacion.numero}
                        </div>
                        <div>
                            <strong>Fecha:</strong> ${new Date(cotizacion.fecha).toLocaleDateString()}
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-bold mb-2">CLIENTE:</h3>
                    <p>${cotizacion.cliente_nombre}</p>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-bold mb-2">DESCRIPCI√ìN DEL PROYECTO:</h3>
                    <p>${cotizacion.titulo || 'Servicios profesionales'}</p>
                </div>
                
                <table class="w-full border-collapse border border-gray-300 mb-6">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2 text-left">Descripci√≥n</th>
                            <th class="border border-gray-300 p-2 text-center">Cantidad</th>
                            <th class="border border-gray-300 p-2 text-right">Precio Unit.</th>
                            <th class="border border-gray-300 p-2 text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Array.from({length: cotizacion.items}, (_, i) => `
                            <tr>
                                <td class="border border-gray-300 p-2">Item ${i + 1}</td>
                                <td class="border border-gray-300 p-2 text-center">1</td>
                                <td class="border border-gray-300 p-2 text-right">$${(cotizacion.total / cotizacion.items).toFixed(2)}</td>
                                <td class="border border-gray-300 p-2 text-right">$${(cotizacion.total / cotizacion.items).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="text-right mb-6">
                    <div class="inline-block text-left">
                        <div class="flex justify-between w-64">
                            <span>Subtotal:</span>
                            <span>$${(cotizacion.total / 1.18).toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between w-64">
                            <span>IVA (18%):</span>
                            <span>$${(cotizacion.total - (cotizacion.total / 1.18)).toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between w-64 font-bold text-lg border-t border-gray-300 mt-2 pt-2">
                            <span>TOTAL:</span>
                            <span>$${cotizacion.total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center text-sm text-gray-600 mt-8">
                    <p>Esta cotizaci√≥n es v√°lida por 30 d√≠as a partir de la fecha de emisi√≥n.</p>
                    <p>Gracias por su preferencia.</p>
                </div>
            `;
        }

        // ==================== NOTIFICACIONES ====================
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 backdrop-blur-lg ${
                tipo === 'success' ? 'bg-green-500/90 text-white' :
                tipo === 'error' ? 'bg-red-500/90 text-white' :
                tipo === 'warning' ? 'bg-yellow-500/90 text-white' :
                'bg-blue-500/90 text-white'
            }`;
            notification.textContent = mensaje;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s ease-out';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Animaci√≥n fadeOut
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100px); }
            }
        `;
        document.head.appendChild(style);

        // Manejar el formulario de cotizaci√≥n
        document.getElementById('formCotizacion').addEventListener('submit', function(e) {
            e.preventDefault();
            mostrarNotificacion('‚úÖ Cotizaci√≥n enviada correctamente', 'success');
            cerrarModalCotizacion();
        });
    </script>
</body>
</html>