<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario - BS Dash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --ubuntu-dark: #2D0922;
            --ubuntu-purple: #77216F;
            --ubuntu-orange: #E95420;
            --ubuntu-light: #f5f5f5;
        }
        
        .bs-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .bs-btn {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(119, 33, 111, 0.2);
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        
        .bs-btn:hover {
            background: rgba(119, 33, 111, 0.1);
            transform: translateY(-1px);
        }
        
        .bs-btn-primary {
            background: linear-gradient(135deg, var(--ubuntu-purple), var(--ubuntu-orange));
            color: white;
            border: none;
        }
        
        .bs-btn-primary:hover {
            background: linear-gradient(135deg, var(--ubuntu-orange), var(--ubuntu-purple));
            transform: translateY(-1px);
        }
        
        .bs-input, .bs-select {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(119, 33, 111, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .bs-input:focus, .bs-select:focus {
            outline: none;
            border-color: var(--ubuntu-purple);
            box-shadow: 0 0 0 2px rgba(119, 33, 111, 0.2);
        }
        
        .bs-stat-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .bs-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }
        
        .producto-card {
            transition: all 0.3s ease;
        }
        
        .producto-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stock-bajo {
            background: rgba(254, 243, 199, 0.7);
            border-left: 4px solid #f59e0b;
        }
        
        .stock-critico {
            background: rgba(254, 202, 202, 0.7);
            border-left: 4px solid #dc2626;
        }
        
        .categoria-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(119, 33, 111, 0.1);
            color: var(--ubuntu-purple);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 9, 34, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .tabla-fila:hover {
            background: rgba(119, 33, 111, 0.05);
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .filtro-avanzado {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(119, 33, 111, 0.2);
        }
        
        .reporte-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .reporte-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-[#2D0922] to-[#77216F] min-h-screen">
    <!-- Header -->
    <header class="bs-card mx-4 mt-4 mb-6">
        <div class="flex items-center justify-between p-4">
            <div class="flex items-center gap-4">
                <a href="../dashboard.html" class="bs-btn">
                    <i class="bi bi-arrow-left"></i> Volver al Dashboard
                </a>
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-[#77216F] to-[#E95420] rounded-xl flex items-center justify-center text-white">
                        <i class="bi bi-box-seam"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Gestión de Inventario</h1>
                        <p class="text-sm text-gray-600">Productos, categorías y control de stock</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <span class="text-gray-700" id="userName">Admin</span>
                <button onclick="abrirLectorBarras()" class="bs-btn">
                    <i class="bi bi-upc-scan"></i> Escanear
                </button>
                <button onclick="logout()" class="bs-btn bg-red-500 text-white hover:bg-red-600">
                    <i class="bi bi-box-arrow-right"></i> Salir
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4">
        <!-- Barra de Herramientas -->
        <div class="bs-card p-6 mb-6">
            <div class="flex flex-col md:flex-row gap-4 justify-between items-start md:items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Productos</h2>
                    <p class="text-gray-600">Gestiona tu inventario de productos</p>
                </div>
                
                <div class="flex flex-wrap gap-3">
                    <button onclick="abrirBusquedaAvanzada()" class="bs-btn">
                        <i class="bi bi-search"></i> Búsqueda Avanzada
                    </button>
                    <button onclick="generarReporteInventario()" class="bs-btn">
                        <i class="bi bi-graph-up"></i> Reportes
                    </button>
                    <button onclick="abrirModalProducto()" class="bs-btn bs-btn-primary">
                        <i class="bi bi-plus-lg"></i> Nuevo Producto
                    </button>
                </div>
            </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bs-stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Total Productos</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="totalProductos">0</h3>
                    </div>
                    <i class="bi bi-box text-purple-600 text-2xl"></i>
                </div>
            </div>
            
            <div class="bs-stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">En Stock</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="totalStock">0</h3>
                    </div>
                    <i class="bi bi-check-circle text-green-600 text-2xl"></i>
                </div>
            </div>
            
            <div class="bs-stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Bajo Stock</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="bajoStock">0</h3>
                    </div>
                    <i class="bi bi-exclamation-triangle text-yellow-600 text-2xl"></i>
                </div>
            </div>
            
            <div class="bs-stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Sin Stock</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="sinStock">0</h3>
                    </div>
                    <i class="bi bi-x-circle text-red-600 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Filtros Rápidos -->
        <div class="bs-card p-4 mb-6">
            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-[200px]">
                    <input type="text" id="buscarProducto" placeholder="Buscar productos..." 
                           class="bs-input w-full" onkeyup="filtrarProductos()">
                </div>
                <select id="filtroCategoria" class="bs-select" onchange="filtrarProductos()">
                    <option value="">Todas las categorías</option>
                </select>
                <select id="filtroEstado" class="bs-select" onchange="filtrarProductos()">
                    <option value="">Todos los estados</option>
                    <option value="stock-alto">Stock Alto</option>
                    <option value="stock-bajo">Stock Bajo</option>
                    <option value="sin-stock">Sin Stock</option>
                    <option value="inactivo">Inactivos</option>
                </select>
                <button onclick="exportarInventario()" class="bs-btn">
                    <i class="bi bi-download"></i> Exportar
                </button>
                <button onclick="toggleFiltrosAvanzados()" class="bs-btn">
                    <i class="bi bi-funnel"></i> Filtros Avanzados
                </button>
            </div>
            
            <!-- Filtros Avanzados -->
            <div id="filtrosAvanzados" class="filtro-avanzado hidden mt-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rango de Precio</label>
                        <div class="flex gap-2">
                            <input type="number" id="precioMin" placeholder="Mín" class="bs-input" onchange="filtrarProductos()">
                            <input type="number" id="precioMax" placeholder="Máx" class="bs-input" onchange="filtrarProductos()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rango de Stock</label>
                        <div class="flex gap-2">
                            <input type="number" id="stockMin" placeholder="Mín" class="bs-input" onchange="filtrarProductos()">
                            <input type="number" id="stockMax" placeholder="Máx" class="bs-input" onchange="filtrarProductos()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Proveedor</label>
                        <select id="filtroProveedor" class="bs-input w-full" onchange="filtrarProductos()">
                            <option value="">Todos los proveedores</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-between items-center mt-4">
                    <button onclick="limpiarFiltros()" class="bs-btn bg-gray-100 text-gray-700">
                        <i class="bi bi-arrow-clockwise"></i> Limpiar Filtros
                    </button>
                    <span class="text-sm text-gray-500" id="contadorResultados">0 productos encontrados</span>
                </div>
            </div>
        </div>

        <!-- Vista de Productos -->
        <div class="mb-6">
            <div class="flex gap-2 mb-4">
                <button id="btnVistaTabla" class="bs-btn bs-btn-primary" onclick="cambiarVista('tabla')">
                    <i class="bi bi-list"></i> Vista Tabla
                </button>
                <button id="btnVistaTarjetas" class="bs-btn" onclick="cambiarVista('tarjetas')">
                    <i class="bi bi-grid"></i> Vista Tarjetas
                </button>
            </div>

            <!-- Vista Tabla -->
            <div id="vistaTabla" class="bs-card p-6">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 cursor-pointer" onclick="ordenarTabla('codigo')">
                                    Código <i class="bi bi-arrow-down-up text-xs"></i>
                                </th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 cursor-pointer" onclick="ordenarTabla('nombre')">
                                    Producto <i class="bi bi-arrow-down-up text-xs"></i>
                                </th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 cursor-pointer" onclick="ordenarTabla('categoria')">
                                    Categoría <i class="bi bi-arrow-down-up text-xs"></i>
                                </th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 cursor-pointer" onclick="ordenarTabla('precio_venta')">
                                    Precio <i class="bi bi-arrow-down-up text-xs"></i>
                                </th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700 cursor-pointer" onclick="ordenarTabla('stock')">
                                    Stock <i class="bi bi-arrow-down-up text-xs"></i>
                                </th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Estado</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-700">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaProductos">
                            <!-- Los productos se cargan aquí -->
                        </tbody>
                    </table>
                </div>
                
                <div id="loadingProductos" class="text-center py-8">
                    <p class="text-gray-500">Cargando productos...</p>
                </div>
                
                <div id="noProductos" class="text-center py-8 hidden">
                    <p class="text-gray-500">No hay productos registrados</p>
                    <button onclick="abrirModalProducto()" class="bs-btn bs-btn-primary mt-4">
                        <i class="bi bi-plus"></i> Agregar Primer Producto
                    </button>
                </div>
                
                <!-- Paginación -->
                <div id="paginacion" class="flex justify-between items-center mt-4 hidden">
                    <div class="text-sm text-gray-500" id="infoPaginacion"></div>
                    <div class="flex gap-2">
                        <button id="btnAnterior" class="bs-btn" onclick="cambiarPagina(-1)">
                            <i class="bi bi-chevron-left"></i> Anterior
                        </button>
                        <button id="btnSiguiente" class="bs-btn" onclick="cambiarPagina(1)">
                            Siguiente <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Vista Tarjetas -->
            <div id="vistaTarjetas" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="gridProductos">
                    <!-- Los productos en tarjetas se cargan aquí -->
                </div>
            </div>
        </div>

        <!-- Movimientos de Inventario -->
        <div class="bs-card p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="bi bi-arrow-left-right text-purple-600"></i>
                Movimientos Recientes
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Fecha</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Producto</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Tipo</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Cantidad</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Stock Final</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Usuario</th>
                        </tr>
                    </thead>
                    <tbody id="tablaMovimientos">
                        <!-- Los movimientos se cargan aquí -->
                    </tbody>
                </table>
            </div>
            
            <div class="text-center mt-4">
                <button onclick="verTodosMovimientos()" class="bs-btn">
                    <i class="bi bi-clock-history"></i> Ver Todos los Movimientos
                </button>
            </div>
        </div>
    </main>

    <!-- Modal Producto -->
    <div id="modalProducto" class="modal-overlay">
        <div class="modal-content p-6 w-full max-w-4xl">
            <h3 class="text-xl font-bold mb-4" id="tituloModalProducto">Nuevo Producto</h3>
            
            <form id="formProducto" class="space-y-6">
                <!-- Información Básica -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Código *</label>
                        <div class="flex gap-2">
                            <input type="text" id="productoCodigo" class="bs-input flex-1" required>
                            <button type="button" onclick="generarCodigoBarras()" class="bs-btn">
                                <i class="bi bi-upc-scan"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre *</label>
                        <input type="text" id="productoNombre" class="bs-input w-full" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoría *</label>
                        <select id="productoCategoria" class="bs-input w-full" required>
                            <option value="">Seleccionar categoría...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Subcategoría</label>
                        <select id="productoSubcategoria" class="bs-input w-full">
                            <option value="">Seleccionar subcategoría...</option>
                        </select>
                    </div>
                </div>

                <!-- Precios -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Precio Costo (RD$)</label>
                        <input type="number" id="productoPrecioCosto" class="bs-input w-full" step="0.01" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Precio Venta (RD$)</label>
                        <input type="number" id="productoPrecioVenta" class="bs-input w-full" step="0.01" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Precio Mayorista (RD$)</label>
                        <input type="number" id="productoPrecioMayorista" class="bs-input w-full" step="0.01" min="0">
                    </div>
                </div>

                <!-- Stock -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stock Actual</label>
                        <input type="number" id="productoStock" class="bs-input w-full" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stock Mínimo</label>
                        <input type="number" id="productoStockMinimo" class="bs-input w-full" value="5" min="0">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stock Máximo</label>
                        <input type="number" id="productoStockMaximo" class="bs-input w-full" min="0">
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Proveedor</label>
                        <select id="productoProveedor" class="bs-input w-full">
                            <option value="">Seleccionar proveedor...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ubicación/Almacén</label>
                        <input type="text" id="productoUbicacion" class="bs-input w-full" placeholder="Almacén Principal">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
                    <textarea id="productoDescripcion" class="bs-input w-full" rows="3" placeholder="Descripción del producto..."></textarea>
                </div>

                <!-- Atributos -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Atributos</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="atributosContainer">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Color</label>
                            <input type="text" class="bs-input w-full" placeholder="Ej: Rojo">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Tamaño</label>
                            <input type="text" class="bs-input w-full" placeholder="Ej: M">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Marca</label>
                            <input type="text" class="bs-input w-full" placeholder="Ej: Sony">
                        </div>
                    </div>
                </div>

                <!-- Estado -->
                <div class="flex items-center">
                    <input type="checkbox" id="productoActivo" class="w-4 h-4" checked>
                    <label for="productoActivo" class="ml-2 text-sm text-gray-700">Producto activo</label>
                </div>

                <div class="flex gap-3 justify-end pt-4">
                    <button type="button" onclick="cerrarModalProducto()" class="bs-btn">Cancelar</button>
                    <button type="submit" class="bs-btn bs-btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajuste de Stock -->
    <div id="modalAjusteStock" class="modal-overlay">
        <div class="modal-content p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Ajuste de Stock</h3>
            
            <form id="formAjusteStock" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Producto</label>
                    <p class="font-medium" id="productoAjusteNombre"></p>
                    <p class="text-sm text-gray-500" id="productoAjusteCodigo"></p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Actual</label>
                    <p class="font-semibold" id="productoAjusteStockActual">0</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Ajuste</label>
                    <select id="tipoAjuste" class="bs-input w-full" onchange="cambiarTipoAjuste()">
                        <option value="entrada">Entrada de Stock</option>
                        <option value="salida">Salida de Stock</option>
                        <option value="ajuste">Ajuste Manual</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad</label>
                    <input type="number" id="cantidadAjuste" class="bs-input w-full" min="1" required>
                </div>
                
                <div id="campoProveedor" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Proveedor</label>
                    <select id="proveedorAjuste" class="bs-input w-full">
                        <option value="">Seleccionar proveedor...</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Motivo</label>
                    <textarea id="motivoAjuste" class="bs-input w-full" rows="3" placeholder="Motivo del ajuste..." required></textarea>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="cerrarModalAjuste()" class="bs-btn flex-1">Cancelar</button>
                    <button type="submit" class="bs-btn bs-btn-primary flex-1">Aplicar Ajuste</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Reportes -->
    <div id="modalReportes" class="modal-overlay">
        <div class="modal-content p-6 w-full max-w-4xl">
            <h3 class="text-xl font-bold mb-4">Reportes de Inventario</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="reporte-card cursor-pointer" onclick="generarReporte('stock-bajo')">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="bi bi-exclamation-triangle text-yellow-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Stock Bajo</h4>
                            <p class="text-sm text-gray-500">Productos con stock mínimo</p>
                        </div>
                    </div>
                </div>
                
                <div class="reporte-card cursor-pointer" onclick="generarReporte('sin-stock')">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="bi bi-x-circle text-red-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Sin Stock</h4>
                            <p class="text-sm text-gray-500">Productos agotados</p>
                        </div>
                    </div>
                </div>
                
                <div class="reporte-card cursor-pointer" onclick="generarReporte('valorizacion')">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="bi bi-currency-dollar text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Valorización</h4>
                            <p class="text-sm text-gray-500">Valor total del inventario</p>
                        </div>
                    </div>
                </div>
                
                <div class="reporte-card cursor-pointer" onclick="generarReporte('movimientos')">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="bi bi-arrow-left-right text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Movimientos</h4>
                            <p class="text-sm text-gray-500">Historial completo</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 justify-end">
                <button onclick="cerrarModalReportes()" class="bs-btn">Cerrar</button>
                <button onclick="exportarReporteCompleto()" class="bs-btn bs-btn-primary">
                    <i class="bi bi-download"></i> Exportar Reporte Completo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let productoEditando = null;
        let productoAjustando = null;
        let vistaActual = 'tabla';
        let productosFiltrados = [];
        let paginaActual = 1;
        const productosPorPagina = 10;
        let ordenActual = { campo: 'nombre', direccion: 'asc' };

        // Inicializar inventario
        document.addEventListener('DOMContentLoaded', function() {
            inicializarDatos();
            cargarProductos();
            cargarCategorias();
            cargarProveedores();
            cargarMovimientosRecientes();
            actualizarEstadisticas();
        });

        function inicializarDatos() {
            // Inicializar datos de ejemplo si no existen
            if (!localStorage.getItem('productos')) {
                const productosEjemplo = [
                    {
                        id: 1,
                        codigo: 'PROD001',
                        nombre: 'Laptop Dell Inspiron 15',
                        categoria: 'Tecnología',
                        subcategoria: 'Computadoras',
                        precio_costo: 45000,
                        precio_venta: 55000,
                        precio_mayorista: 50000,
                        stock: 8,
                        stock_minimo: 5,
                        stock_maximo: 20,
                        proveedor: 'Distribuidora Nacional',
                        ubicacion: 'Almacén A',
                        descripcion: 'Laptop Dell Inspiron 15 con procesador Intel i5',
                        activo: true,
                        fecha_creacion: new Date().toISOString(),
                        fecha_actualizacion: new Date().toISOString()
                    },
                    {
                        id: 2,
                        codigo: 'PROD002',
                        nombre: 'Mouse Inalámbrico Logitech',
                        categoria: 'Tecnología',
                        subcategoria: 'Accesorios',
                        precio_costo: 800,
                        precio_venta: 1200,
                        precio_mayorista: 1000,
                        stock: 2,
                        stock_minimo: 5,
                        stock_maximo: 50,
                        proveedor: 'Importadora Caribe',
                        ubicacion: 'Almacén B',
                        descripcion: 'Mouse inalámbrico ergonómico',
                        activo: true,
                        fecha_creacion: new Date().toISOString(),
                        fecha_actualizacion: new Date().toISOString()
                    }
                ];
                localStorage.setItem('productos', JSON.stringify(productosEjemplo));
            }
        }

        // Funciones de Productos
        function cargarProductos() {
            const productos = JSON.parse(localStorage.getItem('productos') || '[]');
            productosFiltrados = [...productos];
            aplicarFiltrosYOrden();
        }

        function aplicarFiltrosYOrden() {
            let productos = JSON.parse(localStorage.getItem('productos') || '[]');
            
            // Aplicar filtros básicos
            const termino = document.getElementById('buscarProducto').value.toLowerCase();
            const categoria = document.getElementById('filtroCategoria').value;
            const estado = document.getElementById('filtroEstado').value;
            
            if (termino) {
                productos = productos.filter(p => 
                    p.nombre.toLowerCase().includes(termino) || 
                    p.codigo.toLowerCase().includes(termino) ||
                    p.descripcion?.toLowerCase().includes(termino)
                );
            }
            
            if (categoria) {
                productos = productos.filter(p => p.categoria === categoria);
            }
            
            if (estado) {
                switch(estado) {
                    case 'stock-alto':
                        productos = productos.filter(p => p.stock > (p.stock_minimo || 5));
                        break;
                    case 'stock-bajo':
                        productos = productos.filter(p => p.stock <= (p.stock_minimo || 5) && p.stock > 0);
                        break;
                    case 'sin-stock':
                        productos = productos.filter(p => p.stock === 0);
                        break;
                    case 'inactivo':
                        productos = productos.filter(p => !p.activo);
                        break;
                }
            }
            
            // Aplicar filtros avanzados
            const precioMin = document.getElementById('precioMin').value;
            const precioMax = document.getElementById('precioMax').value;
            const stockMin = document.getElementById('stockMin').value;
            const stockMax = document.getElementById('stockMax').value;
            const proveedor = document.getElementById('filtroProveedor').value;
            
            if (precioMin) {
                productos = productos.filter(p => p.precio_venta >= parseFloat(precioMin));
            }
            
            if (precioMax) {
                productos = productos.filter(p => p.precio_venta <= parseFloat(precioMax));
            }
            
            if (stockMin) {
                productos = productos.filter(p => p.stock >= parseInt(stockMin));
            }
            
            if (stockMax) {
                productos = productos.filter(p => p.stock <= parseInt(stockMax));
            }
            
            if (proveedor) {
                productos = productos.filter(p => p.proveedor === proveedor);
            }
            
            // Aplicar ordenamiento
            productos.sort((a, b) => {
                let valorA = a[ordenActual.campo];
                let valorB = b[ordenActual.campo];
                
                if (typeof valorA === 'string') {
                    valorA = valorA.toLowerCase();
                    valorB = valorB.toLowerCase();
                }
                
                if (valorA < valorB) return ordenActual.direccion === 'asc' ? -1 : 1;
                if (valorA > valorB) return ordenActual.direccion === 'asc' ? 1 : -1;
                return 0;
            });
            
            productosFiltrados = productos;
            actualizarContadorResultados();
            mostrarProductosPaginados();
        }

        function mostrarProductosPaginados() {
            const inicio = (paginaActual - 1) * productosPorPagina;
            const fin = inicio + productosPorPagina;
            const productosPagina = productosFiltrados.slice(inicio, fin);
            
            const tabla = document.getElementById('tablaProductos');
            const grid = document.getElementById('gridProductos');
            const loading = document.getElementById('loadingProductos');
            const noProductos = document.getElementById('noProductos');
            const paginacion = document.getElementById('paginacion');

            loading.classList.add('hidden');
            
            if (productosFiltrados.length === 0) {
                noProductos.classList.remove('hidden');
                tabla.innerHTML = '';
                grid.innerHTML = '';
                paginacion.classList.add('hidden');
                return;
            }

            noProductos.classList.add('hidden');
            paginacion.classList.remove('hidden');
            
            if (vistaActual === 'tabla') {
                mostrarProductosTabla(productosPagina);
            } else {
                mostrarProductosGrid(productosPagina);
            }
            
            actualizarPaginacion();
        }

        function mostrarProductosTabla(productos) {
            const tabla = document.getElementById('tablaProductos');
            tabla.innerHTML = '';

            productos.forEach(producto => {
                const estado = producto.stock === 0 ? 
                    '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">Sin Stock</span>' :
                    producto.stock <= producto.stock_minimo ?
                    '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Bajo Stock</span>' :
                    '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">En Stock</span>';

                const fila = `
                    <tr class="tabla-fila border-b border-gray-200 ${producto.stock <= producto.stock_minimo ? 'stock-bajo' : ''} ${producto.stock === 0 ? 'stock-critico' : ''}">
                        <td class="py-3 px-4 font-mono text-sm">${producto.codigo}</td>
                        <td class="py-3 px-4">
                            <div class="font-medium">${producto.nombre}</div>
                            <div class="text-sm text-gray-500">${producto.descripcion || 'Sin descripción'}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="categoria-badge">${producto.categoria}</span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="font-semibold">RD$${producto.precio_venta.toLocaleString()}</div>
                            <div class="text-xs text-gray-500">Costo: RD$${producto.precio_costo.toLocaleString()}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="font-medium ${producto.stock <= producto.stock_minimo ? 'text-red-600' : 'text-green-600'}">
                                ${producto.stock}
                            </span>
                            <div class="text-xs text-gray-500">min: ${producto.stock_minimo || 0}</div>
                        </td>
                        <td class="py-3 px-4">${estado}</td>
                        <td class="py-3 px-4">
                            <div class="flex gap-2">
                                <button onclick="editarProducto(${producto.id})" class="bs-btn text-sm">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button onclick="ajustarStock(${producto.id})" class="bs-btn bg-green-50 text-green-600 text-sm">
                                    <i class="bi bi-plus-slash-minus"></i>
                                </button>
                                <button onclick="eliminarProducto(${producto.id})" class="bs-btn bg-red-50 text-red-600 text-sm">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tabla.innerHTML += fila;
            });
        }

        function mostrarProductosGrid(productos) {
            const grid = document.getElementById('gridProductos');
            grid.innerHTML = '';

            productos.forEach(producto => {
                const tarjeta = `
                    <div class="producto-card bs-card p-4 ${producto.stock <= producto.stock_minimo ? 'stock-bajo' : ''} ${producto.stock === 0 ? 'stock-critico' : ''}">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-medium text-gray-800">${producto.nombre}</h3>
                                <p class="text-sm text-gray-500 font-mono">${producto.codigo}</p>
                            </div>
                            <span class="categoria-badge">${producto.categoria}</span>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">${producto.descripcion || 'Sin descripción'}</p>
                        
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-bold text-green-600">RD$${producto.precio_venta.toLocaleString()}</span>
                            <span class="font-medium ${producto.stock <= producto.stock_minimo ? 'text-red-600' : 'text-green-600'}">
                                Stock: ${producto.stock}
                            </span>
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="editarProducto(${producto.id})" class="bs-btn flex-1 text-sm">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            <button onclick="ajustarStock(${producto.id})" class="bs-btn bg-green-50 text-green-600 flex-1 text-sm">
                                <i class="bi bi-plus-slash-minus"></i>
                            </button>
                        </div>
                    </div>
                `;
                grid.innerHTML += tarjeta;
            });
        }

        function filtrarProductos() {
            paginaActual = 1;
            aplicarFiltrosYOrden();
        }

        function cambiarVista(tipo) {
            vistaActual = tipo;
            const btnTabla = document.getElementById('btnVistaTabla');
            const btnTarjetas = document.getElementById('btnVistaTarjetas');
            const vistaTabla = document.getElementById('vistaTabla');
            const vistaTarjetas = document.getElementById('vistaTarjetas');
            
            if (tipo === 'tabla') {
                btnTabla.className = 'bs-btn bs-btn-primary';
                btnTarjetas.className = 'bs-btn';
                vistaTabla.classList.remove('hidden');
                vistaTarjetas.classList.add('hidden');
            } else {
                btnTabla.className = 'bs-btn';
                btnTarjetas.className = 'bs-btn bs-btn-primary';
                vistaTabla.classList.add('hidden');
                vistaTarjetas.classList.remove('hidden');
            }
            
            aplicarFiltrosYOrden();
        }

        function ordenarTabla(campo) {
            if (ordenActual.campo === campo) {
                ordenActual.direccion = ordenActual.direccion === 'asc' ? 'desc' : 'asc';
            } else {
                ordenActual.campo = campo;
                ordenActual.direccion = 'asc';
            }
            aplicarFiltrosYOrden();
        }

        // Funciones de Paginación
        function actualizarPaginacion() {
            const totalPaginas = Math.ceil(productosFiltrados.length / productosPorPagina);
            const infoPaginacion = document.getElementById('infoPaginacion');
            const btnAnterior = document.getElementById('btnAnterior');
            const btnSiguiente = document.getElementById('btnSiguiente');
            
            infoPaginacion.textContent = `Página ${paginaActual} de ${totalPaginas} - ${productosFiltrados.length} productos`;
            
            btnAnterior.disabled = paginaActual === 1;
            btnSiguiente.disabled = paginaActual === totalPaginas;
            
            if (btnAnterior.disabled) {
                btnAnterior.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                btnAnterior.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            if (btnSiguiente.disabled) {
                btnSiguiente.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                btnSiguiente.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function cambiarPagina(direccion) {
            const totalPaginas = Math.ceil(productosFiltrados.length / productosPorPagina);
            paginaActual += direccion;
            
            if (paginaActual < 1) paginaActual = 1;
            if (paginaActual > totalPaginas) paginaActual = totalPaginas;
            
            aplicarFiltrosYOrden();
        }

        // Funciones de Filtros Avanzados
        function toggleFiltrosAvanzados() {
            const filtros = document.getElementById('filtrosAvanzados');
            filtros.classList.toggle('hidden');
        }

        function limpiarFiltros() {
            document.getElementById('buscarProducto').value = '';
            document.getElementById('filtroCategoria').value = '';
            document.getElementById('filtroEstado').value = '';
            document.getElementById('precioMin').value = '';
            document.getElementById('precioMax').value = '';
            document.getElementById('stockMin').value = '';
            document.getElementById('stockMax').value = '';
            document.getElementById('filtroProveedor').value = '';
            
            paginaActual = 1;
            aplicarFiltrosYOrden();
        }

        function actualizarContadorResultados() {
            document.getElementById('contadorResultados').textContent = 
                `${productosFiltrados.length} productos encontrados`;
        }

        // Resto del código (funciones de modales, movimientos, categorías, etc.)
        // ... (El resto del código permanece igual que en la versión anterior)

        // Funciones de Reportes
        function generarReporteInventario() {
            document.getElementById('modalReportes').style.display = 'flex';
        }

        function cerrarModalReportes() {
            document.getElementById('modalReportes').style.display = 'none';
        }

        function generarReporte(tipo) {
            let productos = JSON.parse(localStorage.getItem('productos') || '[]');
            let titulo = '';
            let datos = [];
            
            switch(tipo) {
                case 'stock-bajo':
                    titulo = 'Productos con Stock Bajo';
                    datos = productos.filter(p => p.stock <= (p.stock_minimo || 5) && p.stock > 0);
                    break;
                case 'sin-stock':
                    titulo = 'Productos Sin Stock';
                    datos = productos.filter(p => p.stock === 0);
                    break;
                case 'valorizacion':
                    titulo = 'Valorización de Inventario';
                    datos = productos.map(p => ({
                        ...p,
                        valor_total: p.precio_costo * p.stock
                    }));
                    break;
                case 'movimientos':
                    titulo = 'Movimientos de Inventario';
                    datos = JSON.parse(localStorage.getItem('movimientos_inventario') || '[]');
                    break;
            }
            
            const reporte = {
                titulo: titulo,
                tipo: tipo,
                fecha_generacion: new Date().toISOString(),
                datos: datos,
                total_registros: datos.length
            };
            
            const blob = new Blob([JSON.stringify(reporte, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte-${tipo}-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert(`✅ Reporte "${titulo}" generado correctamente`);
        }

        function exportarReporteCompleto() {
            const productos = JSON.parse(localStorage.getItem('productos') || '[]');
            const movimientos = JSON.parse(localStorage.getItem('movimientos_inventario') || '[]');
            
            const reporteCompleto = {
                fecha_exportacion: new Date().toISOString(),
                productos: productos,
                movimientos: movimientos,
                estadisticas: {
                    total_productos: productos.length,
                    valor_total_inventario: productos.reduce((sum, p) => sum + (p.precio_costo * p.stock), 0),
                    productos_bajo_stock: productos.filter(p => p.stock <= (p.stock_minimo || 5) && p.stock > 0).length,
                    productos_sin_stock: productos.filter(p => p.stock === 0).length
                }
            };
            
            const blob = new Blob([JSON.stringify(reporteCompleto, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte-completo-inventario-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('✅ Reporte completo exportado correctamente');
        }

        // Las demás funciones (abrirModalProducto, editarProducto, ajustarStock, etc.)
        // permanecen igual que en el código anterior...

    </script>
</body>
</html>