<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario - BS Dash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="../js/supabase-config.js"></script>
    <style>
        /* ====== ESTILOS UBUNTU GLASS MEJORADOS ====== */
        :root {
            --bg-primary: #2D0922;
            --bg-secondary: #1a0a15;
            --bg-card: rgba(45, 20, 44, 0.75);
            --bg-hover: rgba(85, 40, 80, 0.8);
            --border-light: rgba(255, 255, 255, 0.15);
            --border-hover: rgba(233, 84, 32, 0.6);
            --text-primary: #FFFFFF;
            --text-secondary: #E8E8E8;
            --text-muted: #AAAAAA;
            --accent-orange: #E95420;
            --accent-purple: #77216F;
            --gradient-primary: linear-gradient(135deg, #E95420, #77216F);
            --gradient-card: linear-gradient(135deg, rgba(65, 25, 60, 0.9), rgba(40, 15, 35, 0.9));
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(rgba(38, 1, 83, 0.16), rgba(21, 0, 48, 0.046)), 
                        url('https://plus.unsplash.com/premium_photo-1685793804465-b12bbd8b7281?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=870');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .ubuntu-glass {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: var(--gradient-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .ubuntu-window {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: var(--gradient-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .window-header {
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border-light);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .window-title {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-control {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .window-control.close { background: #FF5F57; }
        .window-control.minimize { background: #FFBD2E; }
        .window-control.maximize { background: #28CA42; }

        .window-control:hover {
            transform: scale(1.1);
        }

        .window-content {
            padding: 25px;
            max-height: 500px;
            overflow-y: auto;
        }

        .ubuntu-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .ubuntu-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(233, 84, 32, 0.2);
        }

        .ubuntu-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .ubuntu-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .ubuntu-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .ubuntu-btn-primary {
            background: var(--gradient-primary);
            border: none;
            color: white;
        }

        .ubuntu-btn-primary:hover {
            background: linear-gradient(135deg, #77216F, #E95420);
            transform: translateY(-2px);
        }

        /* Dock Interno */
        .internal-dock {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(45, 20, 44, 0.5);
            border-radius: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .dock-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            text-align: center;
        }

        .dock-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .dock-item.active {
            background: var(--gradient-primary);
            transform: translateY(-3px);
        }

        .dock-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .dock-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Contenedor de Ventanas */
        .windows-container {
            min-height: 600px;
            position: relative;
        }

        .window {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }

        .window.hidden {
            display: none;
        }

        /* B√∫squeda */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            border-radius: 25px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* Estados */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(32, 201, 151, 0.2);
            color: #20C997;
        }

        .status-inactive {
            background: rgba(255, 107, 107, 0.2);
            color: #FF6B6B;
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes windowOpen {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-window-open {
            animation: windowOpen 0.3s ease-out;
        }

        /* Scrollbar personalizado */
        .window-content::-webkit-scrollbar {
            width: 6px;
        }

        .window-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .window-content::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 3px;
        }

        .window-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
        }

        /* Checkbox personalizado */
        .ubuntu-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border-light);
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .ubuntu-checkbox:checked {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .ubuntu-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Estilos espec√≠ficos para inventario */
        .producto-card {
            transition: all 0.3s ease;
        }

        .producto-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stock-bajo {
            background: rgba(254, 243, 199, 0.2);
            border-left: 4px solid #f59e0b;
        }

        .stock-critico {
            background: rgba(254, 202, 202, 0.2);
            border-left: 4px solid #dc2626;
        }

        .categoria-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(119, 33, 111, 0.2);
            color: var(--text-primary);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 9, 34, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: var(--gradient-card);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-light);
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .tabla-fila:hover {
            background: rgba(119, 33, 111, 0.1);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .filtro-avanzado {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-light);
        }

        .reporte-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .reporte-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .config-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-light);
        }

        .config-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .config-item label {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        .status-indicator .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-indicator.connected .dot {
            background: #10B981;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected .dot {
            background: #EF4444;
        }

        .status-indicator.connecting .dot {
            background: #F59E0B;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .notificacion-global {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notificacion-global.show {
            transform: translateX(0);
        }

        .notificacion-global.success {
            background: #10B981;
        }

        .notificacion-global.error {
            background: #EF4444;
        }

        .notificacion-global.warning {
            background: #F59E0B;
        }

        .notificacion-global.info {
            background: #3B82F6;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="ubuntu-glass mx-4 mt-4 mb-6">
        <div class="flex items-center justify-between p-6">
            <div class="flex items-center gap-4">
                <a href="../dashboard.html" class="ubuntu-btn">
                    <i class="bi bi-arrow-left"></i> Volver al Dashboard
                </a>
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-gradient-to-br from-[#E95420] to-[#77216F]">
                        <i class="bi bi-box-seam text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Gesti√≥n de Inventario</h1>
                        <p class="text-sm text-gray-300">Productos, categor√≠as y control de stock</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Selector de Empresa -->
                <div class="flex items-center gap-2 bg-gray-800 bg-opacity-50 px-3 py-2 rounded-lg border border-gray-700">
                    <label class="text-sm font-medium">Empresa:</label>
                    <select id="empresaSwitcher" class="bg-transparent border-none outline-none text-sm text-white" onchange="cambiarEmpresa()">
                        <option value="1">Berroa Studio S.R.L.</option>
                        <option value="2">Empresa Secundaria</option>
                        <option value="3">Otra Empresa</option>
                    </select>
                </div>

                <span class="text-gray-300" id="userName">Admin</span>
                <button onclick="abrirLectorBarras()" class="ubuntu-btn">
                    <i class="bi bi-upc-scan"></i> Escanear
                </button>
                <button onclick="logout()" class="ubuntu-btn bg-red-500 bg-opacity-20 text-red-400 border-red-500 border-opacity-30">
                    <i class="bi bi-box-arrow-right"></i> Salir
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-8">
        <!-- Barra de B√∫squeda Global -->
        <div class="search-container">
            <input type="text" id="globalSearch" class="search-input" placeholder="Buscar en inventario...">
            <i class="bi bi-search search-icon"></i>
        </div>

        <!-- Dock Interno de M√≥dulos -->
        <div class="internal-dock">
            <div class="dock-item active" onclick="abrirVentana('productos')">
                <i class="bi bi-box-seam"></i>
                <span>Productos</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('categorias')">
                <i class="bi bi-tags"></i>
                <span>Categor√≠as</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('movimientos')">
                <i class="bi bi-arrow-left-right"></i>
                <span>Movimientos</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('reportes')">
                <i class="bi bi-graph-up"></i>
                <span>Reportes</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('proveedores')">
                <i class="bi bi-truck"></i>
                <span>Proveedores</span>
            </div>
            <div class="dock-item" onclick="abrirVentana('configuracion')">
                <i class="bi bi-gear"></i>
                <span>Configuraci√≥n</span>
            </div>
        </div>

        <!-- Contenedor de Ventanas -->
        <div class="windows-container">
            <!-- Ventana: Productos -->
            <div id="ventana-productos" class="ubuntu-window window animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-box-seam"></i>
                        <span>Gesti√≥n de Productos</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('productos')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('productos')"></div>
                        <div class="window-control close" onclick="cerrarVentana('productos')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <!-- Estad√≠sticas R√°pidas -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="ubuntu-glass p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-300">Total Productos</p>
                                    <h3 class="text-2xl font-bold" id="totalProductos">0</h3>
                                </div>
                                <i class="bi bi-box text-purple-400 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="ubuntu-glass p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-300">En Stock</p>
                                    <h3 class="text-2xl font-bold" id="totalStock">0</h3>
                                </div>
                                <i class="bi bi-check-circle text-green-400 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="ubuntu-glass p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-300">Bajo Stock</p>
                                    <h3 class="text-2xl font-bold" id="bajoStock">0</h3>
                                </div>
                                <i class="bi bi-exclamation-triangle text-yellow-400 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="ubuntu-glass p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-300">Sin Stock</p>
                                    <h3 class="text-2xl font-bold" id="sinStock">0</h3>
                                </div>
                                <i class="bi bi-x-circle text-red-400 text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Filtros R√°pidos -->
                    <div class="ubuntu-glass p-4 mb-6">
                        <div class="flex flex-wrap gap-4">
                            <div class="flex-1 min-w-[200px]">
                                <input type="text" id="buscarProducto" placeholder="Buscar productos..." 
                                       class="ubuntu-input w-full" onkeyup="filtrarProductos()">
                            </div>
                            <select id="filtroCategoria" class="ubuntu-input" onchange="filtrarProductos()">
                                <option value="">Todas las categor√≠as</option>
                            </select>
                            <select id="filtroEstado" class="ubuntu-input" onchange="filtrarProductos()">
                                <option value="">Todos los estados</option>
                                <option value="stock-alto">Stock Alto</option>
                                <option value="stock-bajo">Stock Bajo</option>
                                <option value="sin-stock">Sin Stock</option>
                                <option value="inactivo">Inactivos</option>
                            </select>
                            <button onclick="exportarInventario()" class="ubuntu-btn">
                                <i class="bi bi-download"></i> Exportar
                            </button>
                            <button onclick="toggleFiltrosAvanzados()" class="ubuntu-btn">
                                <i class="bi bi-funnel"></i> Filtros Avanzados
                            </button>
                            <button onclick="abrirModalProducto()" class="ubuntu-btn ubuntu-btn-primary">
                                <i class="bi bi-plus-lg"></i> Nuevo Producto
                            </button>
                        </div>
                        
                        <!-- Filtros Avanzados -->
                        <div id="filtrosAvanzados" class="filtro-avanzado hidden mt-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Rango de Precio</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="precioMin" placeholder="M√≠n" class="ubuntu-input" onchange="filtrarProductos()">
                                        <input type="number" id="precioMax" placeholder="M√°x" class="ubuntu-input" onchange="filtrarProductos()">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Rango de Stock</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="stockMin" placeholder="M√≠n" class="ubuntu-input" onchange="filtrarProductos()">
                                        <input type="number" id="stockMax" placeholder="M√°x" class="ubuntu-input" onchange="filtrarProductos()">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Proveedor</label>
                                    <select id="filtroProveedor" class="ubuntu-input w-full" onchange="filtrarProductos()">
                                        <option value="">Todos los proveedores</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-4">
                                <button onclick="limpiarFiltros()" class="ubuntu-btn bg-gray-700 bg-opacity-50 text-gray-300 border-gray-600">
                                    <i class="bi bi-arrow-clockwise"></i> Limpiar Filtros
                                </button>
                                <span class="text-sm text-gray-300" id="contadorResultados">0 productos encontrados</span>
                            </div>
                        </div>
                    </div>

                    <!-- Vista de Productos -->
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button id="btnVistaTabla" class="ubuntu-btn ubuntu-btn-primary" onclick="cambiarVista('tabla')">
                                <i class="bi bi-list"></i> Vista Tabla
                            </button>
                            <button id="btnVistaTarjetas" class="ubuntu-btn" onclick="cambiarVista('tarjetas')">
                                <i class="bi bi-grid"></i> Vista Tarjetas
                            </button>
                        </div>

                        <!-- Vista Tabla -->
                        <div id="vistaTabla" class="ubuntu-glass p-6">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-600">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300 cursor-pointer" onclick="ordenarTabla('codigo')">
                                                C√≥digo <i class="bi bi-arrow-down-up text-xs"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300 cursor-pointer" onclick="ordenarTabla('nombre')">
                                                Producto <i class="bi bi-arrow-down-up text-xs"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300 cursor-pointer" onclick="ordenarTabla('categoria')">
                                                Categor√≠a <i class="bi bi-arrow-down-up text-xs"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300 cursor-pointer" onclick="ordenarTabla('precio_venta')">
                                                Precio <i class="bi bi-arrow-down-up text-xs"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300 cursor-pointer" onclick="ordenarTabla('stock')">
                                                Stock <i class="bi bi-arrow-down-up text-xs"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300">Estado</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-300">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaProductos">
                                        <!-- Los productos se cargan aqu√≠ -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="loadingProductos" class="text-center py-8">
                                <p class="text-gray-400">Cargando productos...</p>
                            </div>
                            
                            <div id="noProductos" class="text-center py-8 hidden">
                                <p class="text-gray-400">No hay productos registrados</p>
                                <button onclick="abrirModalProducto()" class="ubuntu-btn ubuntu-btn-primary mt-4">
                                    <i class="bi bi-plus"></i> Agregar Primer Producto
                                </button>
                            </div>
                            
                            <!-- Paginaci√≥n -->
                            <div id="paginacion" class="flex justify-between items-center mt-4 hidden">
                                <div class="text-sm text-gray-400" id="infoPaginacion"></div>
                                <div class="flex gap-2">
                                    <button id="btnAnterior" class="ubuntu-btn" onclick="cambiarPagina(-1)">
                                        <i class="bi bi-chevron-left"></i> Anterior
                                    </button>
                                    <button id="btnSiguiente" class="ubuntu-btn" onclick="cambiarPagina(1)">
                                        Siguiente <i class="bi bi-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Vista Tarjetas -->
                        <div id="vistaTarjetas" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="gridProductos">
                                <!-- Los productos en tarjetas se cargan aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ventana: Configuraci√≥n -->
            <div id="ventana-configuracion" class="ubuntu-window window hidden animate-window-open">
                <div class="window-header">
                    <div class="window-title">
                        <i class="bi bi-gear"></i>
                        <span>Configuraci√≥n de Inventario</span>
                    </div>
                    <div class="window-controls">
                        <div class="window-control minimize" onclick="minimizarVentana('configuracion')"></div>
                        <div class="window-control maximize" onclick="maximizarVentana('configuracion')"></div>
                        <div class="window-control close" onclick="cerrarVentana('configuracion')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="config-section">
                        <h3><i class="bi bi-database"></i> Estado de Conexi√≥n</h3>
                        <div class="flex items-center gap-4 mb-4">
                            <div id="supabaseStatus" class="status-indicator">
                                <div class="dot"></div>
                                <span>Cargando estado...</span>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3><i class="bi bi-gear"></i> Configuraci√≥n de Base de Datos</h3>
                        <div class="config-grid">
                            <div class="config-item">
                                <label for="supabaseUrl">URL de Supabase</label>
                                <input type="url" id="supabaseUrl" class="ubuntu-input" placeholder="https://tu-proyecto.supabase.co">
                            </div>
                            <div class="config-item">
                                <label for="supabaseKey">API Key</label>
                                <input type="password" id="supabaseKey" class="ubuntu-input" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                            </div>
                            <div class="config-item">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="supabaseEnabled" class="ubuntu-checkbox">
                                    <span>Habilitar Supabase</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3><i class="bi bi-tools"></i> Herramientas</h3>
                        <div class="flex gap-3 flex-wrap">
                            <button onclick="guardarConfigSupabase()" class="ubuntu-btn ubuntu-btn-primary">
                                <i class="bi bi-save"></i> Guardar Configuraci√≥n
                            </button>
                            <button onclick="testSupabaseConnection()" class="ubuntu-btn">
                                <i class="bi bi-plug"></i> Probar Conexi√≥n
                            </button>
                            <button onclick="sincronizarConSupabase()" class="ubuntu-btn">
                                <i class="bi bi-arrow-repeat"></i> Sincronizar Datos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Otras ventanas (categor√≠as, movimientos, reportes, proveedores) -->
            <!-- ... (mantener el mismo contenido que en el archivo original) ... -->
        </div>
    </main>

    <!-- Modal Producto -->
    <div id="modalProducto" class="modal-overlay">
        <div class="modal-content p-6 w-full max-w-4xl">
            <h3 class="text-xl font-bold mb-4" id="tituloModalProducto">Nuevo Producto</h3>
            
            <form id="formProducto" class="space-y-6">
                <!-- Informaci√≥n B√°sica -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">C√≥digo *</label>
                        <div class="flex gap-2">
                            <input type="text" id="productoCodigo" class="ubuntu-input flex-1" required>
                            <button type="button" onclick="generarCodigoBarras()" class="ubuntu-btn">
                                <i class="bi bi-upc-scan"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Nombre *</label>
                        <input type="text" id="productoNombre" class="ubuntu-input w-full" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Categor√≠a *</label>
                        <select id="productoCategoria" class="ubuntu-input w-full" required>
                            <option value="">Seleccionar categor√≠a...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Subcategor√≠a</label>
                        <select id="productoSubcategoria" class="ubuntu-input w-full">
                            <option value="">Seleccionar subcategor√≠a...</option>
                        </select>
                    </div>
                </div>

                <!-- Precios -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Precio Costo (RD$)</label>
                        <input type="number" id="productoPrecioCosto" class="ubuntu-input w-full" step="0.01" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Precio Venta (RD$)</label>
                        <input type="number" id="productoPrecioVenta" class="ubuntu-input w-full" step="0.01" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Precio Mayorista (RD$)</label>
                        <input type="number" id="productoPrecioMayorista" class="ubuntu-input w-full" step="0.01" min="0">
                    </div>
                </div>

                <!-- Stock -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Stock Actual</label>
                        <input type="number" id="productoStock" class="ubuntu-input w-full" min="0" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Stock M√≠nimo</label>
                        <input type="number" id="productoStockMinimo" class="ubuntu-input w-full" value="5" min="0">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Stock M√°ximo</label>
                        <input type="number" id="productoStockMaximo" class="ubuntu-input w-full" min="0">
                    </div>
                </div>

                <!-- Informaci√≥n Adicional -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Proveedor</label>
                        <select id="productoProveedor" class="ubuntu-input w-full">
                            <option value="">Seleccionar proveedor...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Ubicaci√≥n/Almac√©n</label>
                        <input type="text" id="productoUbicacion" class="ubuntu-input w-full" placeholder="Almac√©n Principal">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Descripci√≥n</label>
                    <textarea id="productoDescripcion" class="ubuntu-input w-full" rows="3" placeholder="Descripci√≥n del producto..."></textarea>
                </div>

                <!-- Estado -->
                <div class="flex items-center">
                    <input type="checkbox" id="productoActivo" class="ubuntu-checkbox" checked>
                    <label for="productoActivo" class="ml-2 text-sm text-gray-300">Producto activo</label>
                </div>

                <div class="flex gap-3 justify-end pt-4">
                    <button type="button" onclick="cerrarModalProducto()" class="ubuntu-btn">Cancelar</button>
                    <button type="submit" class="ubuntu-btn ubuntu-btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajuste de Stock -->
    <div id="modalAjusteStock" class="modal-overlay">
        <div class="modal-content p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Ajuste de Stock</h3>
            
            <form id="formAjusteStock" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Producto</label>
                    <p class="font-medium" id="productoAjusteNombre"></p>
                    <p class="text-sm text-gray-400" id="productoAjusteCodigo"></p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Stock Actual</label>
                    <p class="font-semibold" id="productoAjusteStockActual">0</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tipo de Ajuste</label>
                    <select id="tipoAjuste" class="ubuntu-input w-full" onchange="cambiarTipoAjuste()">
                        <option value="entrada">Entrada de Stock</option>
                        <option value="salida">Salida de Stock</option>
                        <option value="ajuste">Ajuste Manual</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Cantidad</label>
                    <input type="number" id="cantidadAjuste" class="ubuntu-input w-full" min="1" required>
                </div>
                
                <div id="campoProveedor" class="hidden">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Proveedor</label>
                    <select id="proveedorAjuste" class="ubuntu-input w-full">
                        <option value="">Seleccionar proveedor...</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Motivo</label>
                    <textarea id="motivoAjuste" class="ubuntu-input w-full" rows="3" placeholder="Motivo del ajuste..." required></textarea>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="cerrarModalAjuste()" class="ubuntu-btn flex-1">Cancelar</button>
                    <button type="submit" class="ubuntu-btn ubuntu-btn-primary flex-1">Aplicar Ajuste</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let productoEditando = null;
        let productoAjustando = null;
        let vistaActual = 'tabla';
        let productosFiltrados = [];
        let paginaActual = 1;
        const productosPorPagina = 10;
        let ordenActual = { campo: 'nombre', direccion: 'asc' };
        let supabaseManager = null;

        // Inicializar inventario
        document.addEventListener('DOMContentLoaded', function() {
            inicializarDatos();
            inicializarSupabase();
            cargarProductos();
            cargarCategorias();
            cargarProveedores();
            cargarMovimientosRecientes();
            actualizarEstadisticas();
        });

        async function inicializarSupabase() {
            if (typeof window.supabaseManager !== 'undefined') {
                supabaseManager = window.supabaseManager;
                actualizarEstadoSupabase();
            }
        }

        function actualizarEstadoSupabase() {
            const statusElement = document.getElementById('supabaseStatus');
            if (!statusElement || !supabaseManager) return;

            const status = supabaseManager.getStatus();
            
            if (status.isConnected && status.hasClient) {
                statusElement.className = 'status-indicator connected';
                statusElement.innerHTML = `
                    <div class="dot"></div>
                    <span class="text-green-400">Conectado</span>
                    <span class="text-xs text-gray-400 truncate">${obtenerDominioSupabase(status.projectUrl)}</span>
                `;
            } else if (status.projectUrl && status.hasApiKey) {
                statusElement.className = 'status-indicator connecting';
                statusElement.innerHTML = `
                    <div class="dot"></div>
                    <span class="text-yellow-400">Configurado (No conectado)</span>
                `;
            } else {
                statusElement.className = 'status-indicator disconnected';
                statusElement.innerHTML = `
                    <div class="dot"></div>
                    <span class="text-red-400">No configurado</span>
                `;
            }
        }

        function obtenerDominioSupabase(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname;
            } catch {
                return url;
            }
        }

        function cargarConfigSupabase() {
            if (!supabaseManager) return;
            
            const config = JSON.parse(localStorage.getItem('bs_supabase_config') || '{}');
            
            document.getElementById('supabaseUrl').value = config.url || '';
            document.getElementById('supabaseKey').value = config.key || '';
            document.getElementById('supabaseEnabled').checked = config.enabled || false;
        }

        async function guardarConfigSupabase() {
            if (!supabaseManager) {
                mostrarNotificacion('‚ùå Supabase Manager no disponible', 'error');
                return;
            }

            try {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();
                const enabled = document.getElementById('supabaseEnabled').checked;

                if (enabled && (!url || !key)) {
                    mostrarNotificacion('‚ùå URL y API Key son requeridos para habilitar Supabase', 'error');
                    return;
                }

                // Guardar configuraci√≥n
                supabaseManager.saveConfig(url, key, enabled);
                
                // Inicializar conexi√≥n si est√° habilitado
                if (enabled) {
                    const success = supabaseManager.initializeClient(url, key);
                    if (success) {
                        mostrarNotificacion('‚úÖ Configuraci√≥n Supabase guardada y conectada', 'success');
                        
                        // Probar conexi√≥n autom√°ticamente despu√©s de 1 segundo
                        setTimeout(() => {
                            testSupabaseConnection();
                        }, 1000);
                        
                    } else {
                        mostrarNotificacion('‚ùå Error conectando con Supabase', 'error');
                    }
                } else {
                    supabaseManager.disconnect();
                    mostrarNotificacion('‚úÖ Configuraci√≥n Supabase guardada (desconectado)', 'info');
                }
                
                actualizarEstadoSupabase();
                
            } catch (error) {
                console.error('üí• Error guardando configuraci√≥n Supabase:', error);
                mostrarNotificacion('‚ùå Error guardando configuraci√≥n: ' + error.message, 'error');
            }
        }

        async function testSupabaseConnection() {
            if (!supabaseManager) {
                mostrarNotificacion('‚ùå Supabase Manager no disponible', 'error');
                return;
            }

            mostrarNotificacion('üîå Probando conexi√≥n con Supabase...', 'info');
            
            try {
                const result = await supabaseManager.testConnection();
                
                if (result.success) {
                    mostrarNotificacion('‚úÖ ' + result.message, 'success');
                } else {
                    mostrarNotificacion('‚ùå ' + result.message, 'error');
                }
                
                actualizarEstadoSupabase();
                
            } catch (error) {
                console.error('Error en test de conexi√≥n:', error);
                mostrarNotificacion('‚ùå Error probando conexi√≥n: ' + error.message, 'error');
            }
        }

        async function sincronizarConSupabase() {
            if (!supabaseManager || !supabaseManager.isConnected) {
                mostrarNotificacion('‚ùå No hay conexi√≥n con Supabase', 'error');
                return;
            }

            mostrarNotificacion('üîÑ Sincronizando datos con Supabase...', 'info');
            
            try {
                // Aqu√≠ ir√≠a la l√≥gica de sincronizaci√≥n
                // Por ahora solo simulamos
                setTimeout(() => {
                    mostrarNotificacion('‚úÖ Datos sincronizados correctamente', 'success');
                }, 2000);
                
            } catch (error) {
                console.error('Error sincronizando datos:', error);
                mostrarNotificacion('‚ùå Error sincronizando datos: ' + error.message, 'error');
            }
        }

        // Resto del c√≥digo del inventario (mantener igual que en el archivo original)
        function inicializarDatos() {
            // ... (c√≥digo existente)
        }

        function cargarProductos() {
            // ... (c√≥digo existente)
        }

        function aplicarFiltrosYOrden() {
            // ... (c√≥digo existente)
        }

        function mostrarProductosPaginados() {
            // ... (c√≥digo existente)
        }

        function mostrarProductosTabla(productos) {
            // ... (c√≥digo existente)
        }

        function mostrarProductosGrid(productos) {
            // ... (c√≥digo existente)
        }

        function filtrarProductos() {
            // ... (c√≥digo existente)
        }

        function cambiarVista(tipo) {
            // ... (c√≥digo existente)
        }

        function ordenarTabla(campo) {
            // ... (c√≥digo existente)
        }

        // Funciones de Paginaci√≥n
        function actualizarPaginacion() {
            // ... (c√≥digo existente)
        }

        function cambiarPagina(direccion) {
            // ... (c√≥digo existente)
        }

        // Funciones de Filtros Avanzados
        function toggleFiltrosAvanzados() {
            // ... (c√≥digo existente)
        }

        function limpiarFiltros() {
            // ... (c√≥digo existente)
        }

        function actualizarContadorResultados() {
            // ... (c√≥digo existente)
        }

        // Funciones de Estad√≠sticas
        function actualizarEstadisticas() {
            // ... (c√≥digo existente)
        }

        // Funciones de Ventanas
        function abrirVentana(ventanaId) {
            // ... (c√≥digo existente)
        }

        function minimizarVentana(ventanaId) {
            // ... (c√≥digo existente)
        }

        function maximizarVentana(ventanaId) {
            // ... (c√≥digo existente)
        }

        function cerrarVentana(ventanaId) {
            // ... (c√≥digo existente)
        }

        // Funciones de Movimientos
        function cargarMovimientosRecientes() {
            // ... (c√≥digo existente)
        }

        function verTodosMovimientos() {
            // ... (c√≥digo existente)
        }

        // Funciones de Categor√≠as y Proveedores
        function cargarCategorias() {
            // ... (c√≥digo existente)
        }

        function cargarProveedores() {
            // ... (c√≥digo existente)
        }

        // Funciones de Modales
        function abrirModalProducto() {
            // ... (c√≥digo existente)
        }

        function cerrarModalProducto() {
            // ... (c√≥digo existente)
        }

        function ajustarStock(id) {
            // ... (c√≥digo existente)
        }

        function cerrarModalAjuste() {
            // ... (c√≥digo existente)
        }

        function cambiarTipoAjuste() {
            // ... (c√≥digo existente)
        }

        // Funciones de Reportes
        function generarReporte(tipo) {
            // ... (c√≥digo existente)
        }

        function exportarReporteCompleto() {
            // ... (c√≥digo existente)
        }

        // Funciones de Exportaci√≥n
        function exportarInventario() {
            // ... (c√≥digo existente)
        }

        // Funciones de Utilidad
        function generarCodigoBarras() {
            // ... (c√≥digo existente)
        }

        function abrirLectorBarras() {
            // ... (c√≥digo existente)
        }

        function logout() {
            // ... (c√≥digo existente)
        }

        function cambiarEmpresa() {
            // ... (c√≥digo existente)
        }

        function mostrarNotificacion(mensaje, tipo = 'info') {
            const tipos = {
                success: { bg: 'bg-green-500', icon: 'bi-check-circle' },
                error: { bg: 'bg-red-500', icon: 'bi-exclamation-triangle' },
                warning: { bg: 'bg-yellow-500', icon: 'bi-exclamation-circle' },
                info: { bg: 'bg-blue-500', icon: 'bi-info-circle' }
            };

            const config = tipos[tipo] || tipos.info;
            
            // Eliminar notificaciones existentes
            const notificacionesExistentes = document.querySelectorAll('.notificacion-global');
            notificacionesExistentes.forEach(n => n.remove());
            
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion-global fixed top-4 right-4 ${config.bg} text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3 transform transition-transform duration-300 translate-x-full`;
            notificacion.innerHTML = `
                <i class="bi ${config.icon}"></i>
                <span>${mensaje}</span>
            `;

            document.body.appendChild(notificacion);

            // Animaci√≥n de entrada
            setTimeout(() => {
                notificacion.classList.add('show');
            }, 10);

            // Auto-eliminar despu√©s de 5 segundos
            setTimeout(() => {
                notificacion.classList.remove('show');
                setTimeout(() => {
                    if (notificacion.parentNode) {
                        notificacion.remove();
                    }
                }, 300);
            }, 5000);
        }

        // Manejo del formulario de producto
        document.getElementById('formProducto').addEventListener('submit', function(e) {
            // ... (c√≥digo existente)
        });

        // Manejo del formulario de ajuste de stock
        document.getElementById('formAjusteStock').addEventListener('submit', function(e) {
            // ... (c√≥digo existente)
        });

        // Funciones de edici√≥n y eliminaci√≥n
        function editarProducto(id) {
            // ... (c√≥digo existente)
        }

        function eliminarProducto(id) {
            // ... (c√≥digo existente)
        }
    </script>
</body>
</html>